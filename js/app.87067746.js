(function(){"use strict";var __webpack_modules__={7573:function(e,t,i){i.d(t,{D:function(){return a},G:function(){return l}});var o=i(7326);const l=0,a={host:l?"http://127.0.0.1:6806":"http://"+window.location.host,mock_widget_id:"20210813151137-w8rymj0",api:[{name:"查询SQL",type:o.bl.QuerySQL,url:"/api/query/sql"},{name:"设置属性",type:o.bl.SetBlockAttrs,url:"/api/attr/setBlockAttrs"},{name:"获取属性",type:o.bl.GetBlockAttrs,url:"/api/attr/getBlockAttrs"},{name:"更新块",type:o.bl.UpdateBlock,url:"/api/block/updateBlock"}],filter_operators:[{name:"not_empty",label:"已填写",operator:"!=",attr_types:["text","number","img","date","select","multi_select","checkbox","rate"]},{name:"empty",label:"未填写",operator:"==",attr_types:["text","number","img","date","select","multi_select","checkbox","rate"]},{name:"is",label:"是",operator:"==",attr_types:["text","date","select","multi_select","rate","img"]},{name:"is_not",label:"不是",operator:"!=",attr_types:["text","date","select","multi_select","rate","img"]},{name:"contains",label:"包含",operator:"like",attr_types:["text","select","multi_select","img"]},{name:"not_contains",label:"不包含",operator:"not like",attr_types:["text","select","multi_select","img"]},{name:"checked",label:"已勾选",operator:"==",attr_types:["checkbox"]},{name:"not_checked",label:"未勾选",operator:"!=",attr_types:["checkbox"]},{name:"earlier_than",label:"早于",operator:"<",attr_types:["date"]},{name:"later_than",label:"晚于",operator:">",attr_types:["date"]},{name:"equal",label:"=",operator:"==",attr_types:["number"]},{name:"not_equal",label:"≠",operator:"!=",attr_types:["number"]},{name:"larger_than",label:">",operator:">",attr_types:["number"]},{name:"larger_or_equal",label:"≥",operator:">=",attr_types:["number"]},{name:"smaller_than",label:"<",operator:"<",attr_types:["number"]},{name:"smaller_or_equal",label:"≤",operator:"<=",attr_types:["number"]}],filter_operators2:{"是":{name:"是",value:"==",types:["text","date"]},"不是":{name:"不是",value:"!=",types:["text","date"]},"包含":{name:"包含",value:"==",types:["text"]},"不包含":{name:"不包含",value:"!=",types:["text"]},"早于":{name:"早于",value:"<",types:["date"]},"晚于":{name:"晚于",value:">",types:["date"]},"=":{name:"=",value:"==",types:["number"]},"≠":{name:"≠",value:"!=",types:["number"]},">":{name:">",value:">",types:["number"]},"<":{name:"<",value:"<",types:["number"]}},tag_colors:[{name:"red",color:"rgb(152, 13, 15)",background:"rgba(203, 64, 66, 0.2)"},{name:"blue",color:"rgb(0, 118, 172)",background:"rgba(46, 169, 223, 0.2)"},{name:"green",color:"rgb(0, 78, 11)",background:"rgba(27, 129, 62, 0.2)"},{name:"yellow",color:"rgb(204, 145, 0)",background:"rgba(255, 196, 8, 0.2)"},{name:"orange",color:"rgb(198, 88, 0)",background:" rgba(249, 139, 42, 0.2)"},{name:"brown",color:"rgb(65, 52, 11)",background:"rgba(116, 103, 62, 0.2)"},{name:"purple",color:" rgb(55, 25, 105)",background:"rgba(106, 76, 156, 0.2)"},{name:"grey",color:"rgb(111, 113, 115)",background:"rgba(162, 164, 166, 0.2)"}],filter_names:[{name:"正文",field:"content",type:"text"},{name:"目录",field:"hpath",type:"text"},{name:"创建时间",field:"created",type:"date"},{name:"更新时间",field:"updated",type:"date"},{name:"类型",field:"type",type:"text"},{name:"标签",field:"tags",type:"text"}],attr_types:[{name:"text",value:"文本"},{name:"number",value:"数字"},{name:"date",value:"日期"},{name:"rate",value:"评分"},{name:"select",value:"单选"},{name:"multi_select",value:"多选"},{name:"checkbox",value:"勾选框"},{name:"img",value:"图片"},{name:"url",value:"网址链接"}],block_types:{doc:"文档",d:"文档",h:"标题",l:"列表",i:"列表项",c:"代码",m:"数学公式",p:"段落",t:"表格",s:"超级块",html:"HTML",widget:"挂件",iframe:"iframe",query_embed:"嵌入块",video:"视频"},count_types:{common:{none:"不展示",total_count:"总记录",unique:"唯一值",with_value:"已填写",without_value:"未填写",null_percent:"为空占比",not_null_percent:"非空占比"},number:{sum:"总和",avg:"平均值",max:"最大值",min:"最小值",range:"范围"},checkbox:{done:"已完成",undone:"未完成"},date:{most_early:"最早",most_late:"最晚"}},system_attrs:[{name:"content",label:"正文",type:"text",source:"system",editable:!0,visible:!0,options:[],count_type:"none"},{name:"markdown",label:"Markdown",type:"text",source:"system",editable:!0,visible:!0,options:[],count_type:"none"},{name:"hpath",label:"目录",type:"text",source:"system",editable:!1,visible:!0,options:[],count_type:"none"},{name:"type",label:"内容块类型",type:"select",source:"system",editable:!1,visible:!0,options:[],count_type:"none"},{name:"box",label:"笔记本 ID",type:"text",source:"system",editable:!1,visible:!1,options:[],count_type:"none"},{name:"created",label:"创建时间",type:"date",source:"system",editable:!1,visible:!0,options:[],count_type:"none"}]}},1862:function(e,t,i){i.d(t,{v:function(){return n}});var o=i(2482),l=i(7573),a=i(7603);class s extends a.ZP{constructor(){super("NoteViews"),(0,o.Z)(this,"notes",void 0),(0,o.Z)(this,"shared_attrs",void 0),(0,o.Z)(this,"widget_attrs",void 0),(0,o.Z)(this,"defaultSchema",{notes:"[widget_id+block_id], id, content, title, alias, created, updated, title_img, tags, hpath, box, memo, type",shared_attrs:"&name, label, type",widget_attrs:"&widget_id, attrs"})}async init(e=""){if(await a.ZP.exists("NoteViews")){await this.open();const e=this.verno,t=this.tables.reduce(((e,{name:t,schema:i})=>(e[t]=[i.primKey.src,...i.indexes.map((e=>e.src))].join(","),e)),{});this.close(),this.version(e).stores(t),await this.open()}else{console.log("初始化 IndexedDB 数据库"),this.version(.1).stores(this.defaultSchema),await this.open();for(const e in l.D.system_attrs)await this.shared_attrs.add(l.D.system_attrs[e]);await this.shared_attrs.add({name:"tags",label:"文档标签",type:"multi_select",source:"system",visible:!1,options:[],count_type:"none"}),await this.shared_attrs.add({name:"title",label:"文档标题",type:"text",source:"system",visible:!1,options:[],count_type:"none"}),await this.shared_attrs.add({name:"title_img",label:"题头图",type:"img",source:"system",visible:!1,options:[],count_type:"none"}),e&&await this.widget_attrs.add({widget_id:e,attrs:[{count:0,label:"正文",name:"content",source:"system",type:"text",options:[],visible:!0,count_type:"total_count"},{count:0,label:"创建时间",name:"created",source:"system",type:"date",options:[],visible:!0},{count:0,label:"内容块类型",name:"type",source:"system",type:"select",options:[],visible:!0}]})}}async upgrade(e,t="add"){await this.init();const i=this.tables.find((e=>"notes"==e.name));let o=i.schema.primKey.src,l="",a="";if("add"==t?e.forEach((e=>{e.name in i.schema.idxByName==0&&(console.log(`变更IndexedDB: 新增 ${e.name} 属性`),l+=", "+e.name)})):i.schema.indexes.forEach((t=>{e.find((e=>e.name==t.name))?(a+=", "+t.name,console.log(`变更IndexedDB: 移除 ${t.name} 属性`)):l+=", "+t.name})),"add"==t&&""!=l||"add"!=t&&""!=a){if("add"==t)for(const e of i.schema.indexes)o+=", "+e.name;l=o+l,console.log("变更IndexedDB: "+l),this.close(),this.version(this.verno+.1).stores({notes:l,shared_attrs:"&name,label,type",widget_attrs:"&widget_id,attrs"}),await this.open()}}}const n=new s},7326:function(e,t,i){var o,l,a,s;i.d(t,{Sd:function(){return s},bW:function(){return a},bl:function(){return o},o2:function(){return l}}),function(e){e["SetBlockAttrs"]="set_block_attrs",e["GetBlockAttrs"]="get_block_attrs",e["UpdateBlock"]="update_block",e["QuerySQL"]="query_sql"}(o||(o={})),function(e){e["Subdoc"]="subdoc",e["CustomSQL"]="custom_sql",e["SelectedNotes"]="selected_notes"}(l||(l={})),function(e){e["Table"]="table-view",e["List"]="list-view",e["Card"]="card-view",e["Calendar"]="calendar-view",e["Kanban"]="kanban-view"}(a||(a={})),function(e){e["DataSource"]="data_source",e["ViewType"]="view_type",e["CustomSQL"]="custom_sql",e["SelectedNotes"]="selected_notes",e["SharedAttrs"]="shared_attrs",e["Sort"]="sort",e["Filters"]="filters",e["WidgetSetting"]="widget_setting",e["TableView"]="table_view",e["ListView"]="list_view",e["CardView"]="card_view"}(s||(s={}))},2880:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{Z:function(){return Widget}});var _Users_allenzhou_Documents_Code_Vue_Siyuan_Widgets_note_views_v3_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(2482),core_js_modules_es_error_cause_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1703),core_js_modules_es_error_cause_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(core_js_modules_es_error_cause_js__WEBPACK_IMPORTED_MODULE_0__),_utils_common__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(6583),_utils_network__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(8153),_Types__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(7326),_Database__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(1862),element_plus__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(5574),_config_config__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(7573);class Widget{constructor(){(0,_Users_allenzhou_Documents_Code_Vue_Siyuan_Widgets_note_views_v3_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_6__.Z)(this,"testMode",_config_config__WEBPACK_IMPORTED_MODULE_5__.G),(0,_Users_allenzhou_Documents_Code_Vue_Siyuan_Widgets_note_views_v3_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_6__.Z)(this,"documentID",""),(0,_Users_allenzhou_Documents_Code_Vue_Siyuan_Widgets_note_views_v3_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_6__.Z)(this,"widgetID",""),(0,_Users_allenzhou_Documents_Code_Vue_Siyuan_Widgets_note_views_v3_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_6__.Z)(this,"widgetName","思源笔记"),(0,_Users_allenzhou_Documents_Code_Vue_Siyuan_Widgets_note_views_v3_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_6__.Z)(this,"widgetNode",document.createElement("div")),(0,_Users_allenzhou_Documents_Code_Vue_Siyuan_Widgets_note_views_v3_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_6__.Z)(this,"reload","true"),(0,_Users_allenzhou_Documents_Code_Vue_Siyuan_Widgets_note_views_v3_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_6__.Z)(this,"viewType",_Types__WEBPACK_IMPORTED_MODULE_3__.bW.Card),(0,_Users_allenzhou_Documents_Code_Vue_Siyuan_Widgets_note_views_v3_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_6__.Z)(this,"dataSource",_Types__WEBPACK_IMPORTED_MODULE_3__.o2.Subdoc),(0,_Users_allenzhou_Documents_Code_Vue_Siyuan_Widgets_note_views_v3_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_6__.Z)(this,"tableView",{tableIndex:"false",tableCount:"true",tableCountMode:"page"}),(0,_Users_allenzhou_Documents_Code_Vue_Siyuan_Widgets_note_views_v3_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_6__.Z)(this,"cardView",{showAttrLabel:"false",coverAttr:"title_img"}),(0,_Users_allenzhou_Documents_Code_Vue_Siyuan_Widgets_note_views_v3_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_6__.Z)(this,"listView",{showAttrLabel:"false"}),(0,_Users_allenzhou_Documents_Code_Vue_Siyuan_Widgets_note_views_v3_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_6__.Z)(this,"selectedNotes",[]),(0,_Users_allenzhou_Documents_Code_Vue_Siyuan_Widgets_note_views_v3_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_6__.Z)(this,"excuteSQL",""),(0,_Users_allenzhou_Documents_Code_Vue_Siyuan_Widgets_note_views_v3_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_6__.Z)(this,"customSQL",""),(0,_Users_allenzhou_Documents_Code_Vue_Siyuan_Widgets_note_views_v3_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_6__.Z)(this,"pageSize",10),(0,_Users_allenzhou_Documents_Code_Vue_Siyuan_Widgets_note_views_v3_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_6__.Z)(this,"currentPage",1),(0,_Users_allenzhou_Documents_Code_Vue_Siyuan_Widgets_note_views_v3_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_6__.Z)(this,"sortField","default"),(0,_Users_allenzhou_Documents_Code_Vue_Siyuan_Widgets_note_views_v3_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_6__.Z)(this,"sortType","asc"),(0,_Users_allenzhou_Documents_Code_Vue_Siyuan_Widgets_note_views_v3_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_6__.Z)(this,"filters",[]),(0,_Users_allenzhou_Documents_Code_Vue_Siyuan_Widgets_note_views_v3_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_6__.Z)(this,"filterMode","and"),(0,_Users_allenzhou_Documents_Code_Vue_Siyuan_Widgets_note_views_v3_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_6__.Z)(this,"filterOn","true"),(0,_Users_allenzhou_Documents_Code_Vue_Siyuan_Widgets_note_views_v3_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_6__.Z)(this,"operators",[]),(0,_Users_allenzhou_Documents_Code_Vue_Siyuan_Widgets_note_views_v3_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_6__.Z)(this,"totalNotes",[]),(0,_Users_allenzhou_Documents_Code_Vue_Siyuan_Widgets_note_views_v3_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_6__.Z)(this,"pageNotes",[]),(0,_Users_allenzhou_Documents_Code_Vue_Siyuan_Widgets_note_views_v3_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_6__.Z)(this,"sharedAttrs",[]),(0,_Users_allenzhou_Documents_Code_Vue_Siyuan_Widgets_note_views_v3_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_6__.Z)(this,"widgetAttrs",[]),(0,_Users_allenzhou_Documents_Code_Vue_Siyuan_Widgets_note_views_v3_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_6__.Z)(this,"attributes",[]),(0,_Users_allenzhou_Documents_Code_Vue_Siyuan_Widgets_note_views_v3_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_6__.Z)(this,"loading",!1),(0,_Users_allenzhou_Documents_Code_Vue_Siyuan_Widgets_note_views_v3_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_6__.Z)(this,"emptyMessage","😭 未查询到笔记，请检查相关设置"),(0,_Users_allenzhou_Documents_Code_Vue_Siyuan_Widgets_note_views_v3_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_6__.Z)(this,"dialogVisible",!1),(0,_Users_allenzhou_Documents_Code_Vue_Siyuan_Widgets_note_views_v3_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_6__.Z)(this,"dialogType",""),(0,_Users_allenzhou_Documents_Code_Vue_Siyuan_Widgets_note_views_v3_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_6__.Z)(this,"showAttrLabel","false"),(0,_Users_allenzhou_Documents_Code_Vue_Siyuan_Widgets_note_views_v3_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_6__.Z)(this,"attrFilterReg",""),(0,_Users_allenzhou_Documents_Code_Vue_Siyuan_Widgets_note_views_v3_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_6__.Z)(this,"tableCount","true"),(0,_Users_allenzhou_Documents_Code_Vue_Siyuan_Widgets_note_views_v3_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_6__.Z)(this,"tableCountMode","page"),(0,_Users_allenzhou_Documents_Code_Vue_Siyuan_Widgets_note_views_v3_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_6__.Z)(this,"selectSuggestions",[]),(0,_Users_allenzhou_Documents_Code_Vue_Siyuan_Widgets_note_views_v3_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_6__.Z)(this,"widgetSetting",{widgetName:"思源笔记",reload:"true",pageSize:9,showAttrLabel:"false",attrFilterReg:"",tableCount:"true",tableCountMode:"page",tableIndex:"false"})}async init(){const e=_utils_common__WEBPACK_IMPORTED_MODULE_1__.getWidgetID();if(e.code=_config_config__WEBPACK_IMPORTED_MODULE_5__.G?1:e.code,e.data=_config_config__WEBPACK_IMPORTED_MODULE_5__.G?{id:_config_config__WEBPACK_IMPORTED_MODULE_5__.D.mock_widget_id,node:document.createElement("div")}:e.data,-1===e.code)throw console.log("获取挂件 ID 失败"),new Error("获取挂件 ID 失败");{this.widgetID=e.data.id,this.documentID=await _utils_common__WEBPACK_IMPORTED_MODULE_1__.getDocumentID(this.widgetID),await _Database__WEBPACK_IMPORTED_MODULE_4__.v.init(this.widgetID);const t=await _Database__WEBPACK_IMPORTED_MODULE_4__.v.widget_attrs.where("widget_id").equals(this.widgetID).toArray();t.length>0&&(this.widgetAttrs=t[0]["attrs"]),this.sharedAttrs=await _Database__WEBPACK_IMPORTED_MODULE_4__.v.shared_attrs.toArray();const i=await _utils_network__WEBPACK_IMPORTED_MODULE_2__.Xk(_Types__WEBPACK_IMPORTED_MODULE_3__.bl.GetBlockAttrs,{id:this.widgetID},"获取挂件设置失败，请尝试重新加载");0===i.code&&this.loadSettings(i.data)}}async loadSettings(e){this.viewType=e["custom-view-type"]||this.viewType,this.dataSource=e["custom-data-source"]||this.dataSource,this.customSQL=_utils_common__WEBPACK_IMPORTED_MODULE_1__.htmlDecode(e["custom-sql"])||this.customSQL,this.sortField=e["custom-sort-field"]||this.sortField,this.sortType=e["custom-sort-type"]||this.sortType,this.filterOn=e["custom-filter-on"]||this.filterOn,this.filterMode=e["custom-filter-mode"]||this.filterMode,this.tableView=_utils_common__WEBPACK_IMPORTED_MODULE_1__.praseJSON(_utils_common__WEBPACK_IMPORTED_MODULE_1__.htmlDecode(e["custom-table-view"]))||this.tableView,this.listView=_utils_common__WEBPACK_IMPORTED_MODULE_1__.praseJSON(_utils_common__WEBPACK_IMPORTED_MODULE_1__.htmlDecode(e["custom-list-view"]))||this.listView,this.cardView=_utils_common__WEBPACK_IMPORTED_MODULE_1__.praseJSON(_utils_common__WEBPACK_IMPORTED_MODULE_1__.htmlDecode(e["custom-card-view"]))||this.cardView,this.selectedNotes=_utils_common__WEBPACK_IMPORTED_MODULE_1__.praseJSON(_utils_common__WEBPACK_IMPORTED_MODULE_1__.htmlDecode(e["custom-selected-notes"]))||this.selectedNotes,this.filters=_utils_common__WEBPACK_IMPORTED_MODULE_1__.praseJSON(_utils_common__WEBPACK_IMPORTED_MODULE_1__.htmlDecode(e["custom-filters"]))||this.filters;const t=_utils_common__WEBPACK_IMPORTED_MODULE_1__.praseJSON(_utils_common__WEBPACK_IMPORTED_MODULE_1__.htmlDecode(e["custom-setting"]));this.widgetSetting=_utils_common__WEBPACK_IMPORTED_MODULE_1__.praseJSON(_utils_common__WEBPACK_IMPORTED_MODULE_1__.htmlDecode(e["custom-setting"]))||this.widgetSetting,t&&(this.reload=t.reload||this.reload,this.widgetName=t.widget_name||this.widgetName,this.pageSize=t.page_size||this.pageSize,this.tableCount=t.table_count||this.tableCount,this.tableCountMode=t.table_count_mode||this.tableCountMode,this.showAttrLabel=t.show_attr_label||this.showAttrLabel,this.attrFilterReg=t.attr_filter||this.attrFilterReg),"custom_sql"==this.dataSource?this.createSQL(_Types__WEBPACK_IMPORTED_MODULE_3__.o2.CustomSQL,{custom_sql:this.customSQL}):"selected_notes"==this.dataSource?this.createSQL(_Types__WEBPACK_IMPORTED_MODULE_3__.o2.SelectedNotes,{selected_notes:this.selectedNotes}):this.createSQL(_Types__WEBPACK_IMPORTED_MODULE_3__.o2.Subdoc,{document_id:this.documentID})}createSQL(e,t){switch(e){case _Types__WEBPACK_IMPORTED_MODULE_3__.o2.Subdoc:this.excuteSQL=`select * from blocks where type = 'd' and path REGEXP '/${t.document_id}/[0123456789]{14}-[abcdefghijklmnopqrstuvwxyz0123456789]{7}.sy'`;break;case _Types__WEBPACK_IMPORTED_MODULE_3__.o2.CustomSQL:this.excuteSQL=t.custom_sql;break;case _Types__WEBPACK_IMPORTED_MODULE_3__.o2.SelectedNotes:{let e="";const i=t.selected_notes;for(let t=0;t<i.length;t++)t==i.length-1?e+=`'${i[t].id}'`:e+="'"+i[t].id+"',";this.excuteSQL=`SELECT * FROM blocks WHERE id IN (${e})`;break}default:this.excuteSQL="";break}}async refresh(){await this.downloadFromSiyuan(),this.filters.length>0&&this.filters.map((e=>{this.operators.push(this.getFilterOperators(e.name))})),await this.fetchLocalNotes(),this.resizeIframe()}async loadNotes(){if("true"==this.reload)await this.downloadFromSiyuan();else{const e=await _Database__WEBPACK_IMPORTED_MODULE_4__.v.widget_attrs.where("widget_id").equals(this.widgetID).toArray();if(e.length>0){this.widgetAttrs=e[0]["attrs"];for(const e of this.widgetAttrs)this.getSharedAttrInfor(e);this.attributes=this.widgetAttrs}else this.attributes=_config_config__WEBPACK_IMPORTED_MODULE_5__.D.system_attrs}this.filters.length>0&&this.filters.map((e=>{this.operators.push(this.getFilterOperators(e.name))})),this.fetchLocalNotes()}getSharedAttrInfor(e){const t=this.sharedAttrs.find((t=>t.name==e.name));return t&&(e.label=t.label,e.type=t.type),e}extractAttrs(e,t,i){const o=this.widgetSetting.attrFilterReg;if(o){const e=new RegExp(o);if(e.test(t))return void console.log("满足正则表达式",t)}const l=t.replaceAll("-","_");let a=_utils_common__WEBPACK_IMPORTED_MODULE_1__.htmlDecode(i);if("title_img"===l&&(a=a.replace("assets/",`${_config_config__WEBPACK_IMPORTED_MODULE_5__.D.host}/assets/`).replace(/background-position:[\s|\S]*?;/gi,"").replace(/min-height:[\s|\S]*?;/gi,"")),"created"!==l&&"updated"!==l||(a=_utils_common__WEBPACK_IMPORTED_MODULE_1__.siyuanTimeToDateStr(a)),"type"===l){_config_config__WEBPACK_IMPORTED_MODULE_5__.D.block_types;a=_config_config__WEBPACK_IMPORTED_MODULE_5__.D.block_types[a]||"未知类型"}const s=this.attributes.find((e=>e.name===l)),n=_config_config__WEBPACK_IMPORTED_MODULE_5__.D.system_attrs.find((e=>e.name===l)),_=this.widgetAttrs.find((e=>e.name===l)),r=this.sharedAttrs.find((e=>e.name===l)),d=n?n["type"]:r?r["type"]:"text",c="select"==d||"multi_select"==d?a.split(","):[a];if(s){if(s.count++,"select"==d||"multi_select"==d)for(const u of c)if(!s.options.find((e=>e.value===u))){const e=Math.floor(6*Math.random())+0;s.options.push({value:u,color:_config_config__WEBPACK_IMPORTED_MODULE_5__.D.tag_colors[e]["name"],hash:_utils_common__WEBPACK_IMPORTED_MODULE_1__.randomWord(!0,4,4)})}}else{let e=[];if("select"==d||"multi_select"==d)if(_){e="select"==d||"multi_select"==d?_.options:[];for(const t of c){const i=_.options.find((e=>e.value===t));if(!i){const i=Math.floor(6*Math.random())+0;e.push({value:t,color:_config_config__WEBPACK_IMPORTED_MODULE_5__.D.tag_colors[i]["name"],hash:_utils_common__WEBPACK_IMPORTED_MODULE_1__.randomWord(!0,4,4)})}}}else for(const t of c){const i=Math.floor(6*Math.random())+0;e.push({value:t,color:_config_config__WEBPACK_IMPORTED_MODULE_5__.D.tag_colors[i]["name"],hash:_utils_common__WEBPACK_IMPORTED_MODULE_1__.randomWord(!0,4,4)})}this.attributes.push({count:1,name:l,options:e,type:d,label:r?r["label"]:l,visible:!!_&&_["visible"],editable:!n||n["editable"],source:l.indexOf("custom")>-1?"custom":"system",count_type:_?_["count_type"]:"none",order:_&&_["order"]?_["order"]:99,width:_&&_["width"]?_["width"]:""})}e[l]=a}sortAttributes(e){const t=[],i=[];return e.forEach((e=>{e.visible?t.push(e):i.push(e)})),_utils_common__WEBPACK_IMPORTED_MODULE_1__.arraySort(t).concat(_utils_common__WEBPACK_IMPORTED_MODULE_1__.arraySort(i))}async downloadFromSiyuan(){if(!this.excuteSQL)throw new Error("请先设置SQL语句");this.loading=!0,await _Database__WEBPACK_IMPORTED_MODULE_4__.v.notes.where("widget_id").equals(this.widgetID).delete();const e=await _utils_network__WEBPACK_IMPORTED_MODULE_2__.Xk(_Types__WEBPACK_IMPORTED_MODULE_3__.bl.QuerySQL,{stmt:this.excuteSQL});if(-1==e.code)return void(this.loading=!1);const t=[];for(const i of e.data){null!=i.updated||""!=i.updated?i.updated:i.created;const e={block_id:i.id,widget_id:this.widgetID};let o;const l=/([a-z|\d|-]+)="([\S|\s]*?)"/gi;while(o=l.exec(i.ial))this.extractAttrs(e,o[1],o[2]);_config_config__WEBPACK_IMPORTED_MODULE_5__.D.system_attrs.forEach((t=>{this.extractAttrs(e,t.name,i[t.name])})),t.push(e)}this.attributes=this.sortAttributes(this.attributes),await _Database__WEBPACK_IMPORTED_MODULE_4__.v.upgrade(this.attributes),_Database__WEBPACK_IMPORTED_MODULE_4__.v.widget_attrs.put({widget_id:this.widgetID,attrs:JSON.parse(JSON.stringify(this.attributes))},this.widgetID),t.forEach((e=>{const t=_Database__WEBPACK_IMPORTED_MODULE_4__.v.notes.schema.idxByName;for(const i in t)e[i]||(e[i]="");_Database__WEBPACK_IMPORTED_MODULE_4__.v.notes.add(e)})),this.loading=!1}async fetchLocalNotes(){let collcetion;this.loading=!0;let filterSQL=`note.widget_id == '${this.widgetID}' `;collcetion="default"!=this.sortField?_Database__WEBPACK_IMPORTED_MODULE_4__.v.notes.orderBy(this.sortField):_Database__WEBPACK_IMPORTED_MODULE_4__.v.notes.toCollection();let condition="";if(this.filters.length>0)for(const[e,t]of this.filters.entries()){const i=t.operator,o=`'${t.value}'`,l=_utils_common__WEBPACK_IMPORTED_MODULE_1__.getAttrType(t.name,this),a=0==e?"":"and"==this.filterMode?"&&":"||",s=_config_config__WEBPACK_IMPORTED_MODULE_5__.D.filter_operators.find((e=>e.name==i));s?-1!=s.attr_types.indexOf(l)?"contains"==t.operator?condition+=` ${a} note.${t.name}.indexOf(${o}) > -1 `:"not_contains"==t.operator?condition+=` ${a} note.${t.name}.indexOf(${o}) == -1 `:"empty"==t.operator?condition+=` ${a} note.${t.name} == '' `:"not_empty"==t.operator?condition+=` ${a} note.${t.name} != '' `:"checked"==t.operator?condition+=` ${a} note.${t.name} == 'true' `:"not_checked"==t.operator?condition+=` ${a} (note.${t.name} == '' || note.${t.name} == 'false') `:condition+=` ${a} note.${t.name} ${s.operator} ${o}`:(element_plus__WEBPACK_IMPORTED_MODULE_7__.z8.warning("部分筛选条件错误，查询时将会被忽略"),console.log(`属性类型[${l}]不支持运算符[${i}]`)):(element_plus__WEBPACK_IMPORTED_MODULE_7__.z8.warning("部分筛选运算符错误，查询时将会被忽略"),console.log(`运算符[${i}]不存在`))}""!=condition&&"true"==this.filterOn&&(filterSQL+=` && (${condition})`),console.log("筛选条件: "+filterSQL);try{collcetion.filter((note=>eval(filterSQL)))}catch(error){collcetion.filter((note=>eval(`note.widget_id == '${this.widgetID}'`))),element_plus__WEBPACK_IMPORTED_MODULE_7__.z8.error("筛选语句错误，已恢复默认筛选")}if("asc"==this.sortType?this.totalNotes=await collcetion.toArray():this.totalNotes=await collcetion.reverse().toArray(),0==this.totalNotes.length){let e="查询结果为空";this.filters.length>0&&"true"==this.filterOn&&(e+=" | 请检查筛选条件是否正确"),this.dataSource==_Types__WEBPACK_IMPORTED_MODULE_3__.o2.Subdoc&&0==this.filters.length&&(e+=" | 未检索到子文档"),this.dataSource==_Types__WEBPACK_IMPORTED_MODULE_3__.o2.CustomSQL&&(e+=" | 请检查 SQL 语句是否正确"),this.dataSource==_Types__WEBPACK_IMPORTED_MODULE_3__.o2.SelectedNotes&&0==this.selectedNotes.length&&(e+="| 未选择笔记"),element_plus__WEBPACK_IMPORTED_MODULE_7__.z8.warning(e),this.pageNotes=[]}else this.pageNotes=this.widgetSetting.pageSize>0?this.totalNotes.slice(0,this.widgetSetting.pageSize):this.totalNotes;this.loading=!1}async saveAttrInfor(e){_Database__WEBPACK_IMPORTED_MODULE_4__.v.shared_attrs.put(JSON.parse(JSON.stringify(e)),e.name),"select"==e.type||"multi_select"==e.type?this.computeSelectOptions(e.name):console.log("变更属性类型为："+e.type)}async saveAttrValue(e,t,i,o,l=this){const a=i,s=i.replaceAll("_","-"),n={},_={};o="number"==typeof o?String(o):o,n[a]=o,_[s]=o;const r=this.totalNotes.find((t=>t.block_id==e));r&&(r[a]=o),_Database__WEBPACK_IMPORTED_MODULE_4__.v.notes.update([l.widgetID,e],n),"content"==i?await _utils_network__WEBPACK_IMPORTED_MODULE_2__.Xk(_Types__WEBPACK_IMPORTED_MODULE_3__.bl.UpdateBlock,{dataType:"markdown",data:o,id:e}):await _utils_network__WEBPACK_IMPORTED_MODULE_2__.Xk(_Types__WEBPACK_IMPORTED_MODULE_3__.bl.SetBlockAttrs,{id:e,attrs:_})}async saveWidgtAttrs(e=this){for(const[t,i]of this.attributes.entries())i.order=t+1;this.attributes=this.sortAttributes(this.attributes),_Database__WEBPACK_IMPORTED_MODULE_4__.v.widget_attrs.put({widget_id:e.widgetID,attrs:JSON.parse(JSON.stringify(e.attributes))},e.widgetID)}async updateAttrOptions(e,t,i){console.log(e,t,i)}async removeSharedAttr(e,t,i=this){await _Database__WEBPACK_IMPORTED_MODULE_4__.v.shared_attrs["delete"](e.name);const o=i.attributes.find((t=>t.name==e.name));o?(console.log(o),o.label="",o.type="text"):console.log("attributes 中未找到对应属性字段"),i.saveWidgtAttrs(i),i.sharedAttrs.splice(t,1),element_plus__WEBPACK_IMPORTED_MODULE_7__.z8.success("属性已移除")}async saveSettings(e,t,i=this){switch(this.dialogVisible=!1,e){case _Types__WEBPACK_IMPORTED_MODULE_3__.Sd.ViewType:i.viewType=t.view_type,_utils_network__WEBPACK_IMPORTED_MODULE_2__.Xk(_Types__WEBPACK_IMPORTED_MODULE_3__.bl.SetBlockAttrs,{id:i.widgetID,attrs:{"custom-view-type":i.viewType}});break;case _Types__WEBPACK_IMPORTED_MODULE_3__.Sd.DataSource:i.dataSource=t.data_source,i.dataSource==_Types__WEBPACK_IMPORTED_MODULE_3__.o2.Subdoc&&(i.createSQL(_Types__WEBPACK_IMPORTED_MODULE_3__.o2.Subdoc,{document_id:i.documentID}),await i.downloadFromSiyuan());break;case _Types__WEBPACK_IMPORTED_MODULE_3__.Sd.CustomSQL:{const e=await _utils_network__WEBPACK_IMPORTED_MODULE_2__.Xk(_Types__WEBPACK_IMPORTED_MODULE_3__.bl.SetBlockAttrs,{id:this.widgetID,attrs:{"custom-data-source":_Types__WEBPACK_IMPORTED_MODULE_3__.o2.CustomSQL,"custom-sql":t.custom_sql}});0==e.code&&(i.dataSource=_Types__WEBPACK_IMPORTED_MODULE_3__.o2.CustomSQL,i.customSQL=t.custom_sql,i.excuteSQL=i.customSQL,await i.downloadFromSiyuan());break}case _Types__WEBPACK_IMPORTED_MODULE_3__.Sd.SelectedNotes:{const e=await _utils_network__WEBPACK_IMPORTED_MODULE_2__.Xk(_Types__WEBPACK_IMPORTED_MODULE_3__.bl.SetBlockAttrs,{id:this.widgetID,attrs:{"custom-data-source":_Types__WEBPACK_IMPORTED_MODULE_3__.o2.SelectedNotes,"custom-selected-notes":JSON.stringify(i.filterSelectedNotes(t.selected_notes))}});0==e.code&&(i.dataSource=_Types__WEBPACK_IMPORTED_MODULE_3__.o2.SelectedNotes,i.selectedNotes=t.selected_notes,i.createSQL(_Types__WEBPACK_IMPORTED_MODULE_3__.o2.SelectedNotes,{selected_notes:t.selected_notes}),await i.downloadFromSiyuan());break}case _Types__WEBPACK_IMPORTED_MODULE_3__.Sd.SharedAttrs:console.log("saveSharedAttrs",this.sharedAttrs);for(const e of this.sharedAttrs)console.log(e),_Database__WEBPACK_IMPORTED_MODULE_4__.v.shared_attrs.put(JSON.parse(JSON.stringify(e)),e.name);break;case _Types__WEBPACK_IMPORTED_MODULE_3__.Sd.Sort:_utils_network__WEBPACK_IMPORTED_MODULE_2__.Xk(_Types__WEBPACK_IMPORTED_MODULE_3__.bl.SetBlockAttrs,{id:this.widgetID,attrs:{"custom-sort-type":i.sortType,"custom-sort-field":i.sortField}});break;case _Types__WEBPACK_IMPORTED_MODULE_3__.Sd.Filters:_utils_network__WEBPACK_IMPORTED_MODULE_2__.Xk(_Types__WEBPACK_IMPORTED_MODULE_3__.bl.SetBlockAttrs,{id:this.widgetID,attrs:{"custom-filters":JSON.stringify(i.filters),"custom-filter-on":i.filterOn,"custom-filter-mode":i.filterMode}});break;case _Types__WEBPACK_IMPORTED_MODULE_3__.Sd.TableView:{const e=await _utils_network__WEBPACK_IMPORTED_MODULE_2__.Xk(_Types__WEBPACK_IMPORTED_MODULE_3__.bl.SetBlockAttrs,{id:this.widgetID,attrs:{"custom-table-view":JSON.stringify(t)}});0==e.code&&(i.tableView.tableIndex=t.tableIndex,i.tableView.tableCount=t.tableCount,i.tableView.tableCountMode=t.tableCountMode);break}case _Types__WEBPACK_IMPORTED_MODULE_3__.Sd.ListView:{const e=await _utils_network__WEBPACK_IMPORTED_MODULE_2__.Xk(_Types__WEBPACK_IMPORTED_MODULE_3__.bl.SetBlockAttrs,{id:this.widgetID,attrs:{"custom-list-view":JSON.stringify(t)}});0==e.code&&(i.listView.showAttrLabel=t.showAttrLabel);break}case _Types__WEBPACK_IMPORTED_MODULE_3__.Sd.CardView:{const e=await _utils_network__WEBPACK_IMPORTED_MODULE_2__.Xk(_Types__WEBPACK_IMPORTED_MODULE_3__.bl.SetBlockAttrs,{id:this.widgetID,attrs:{"custom-card-view":JSON.stringify(t)}});0==e.code&&(i.cardView.showAttrLabel=t.showAttrLabel,i.cardView.coverAttr=t.coverAttr);break}case _Types__WEBPACK_IMPORTED_MODULE_3__.Sd.WidgetSetting:{const e=await _utils_network__WEBPACK_IMPORTED_MODULE_2__.Xk(_Types__WEBPACK_IMPORTED_MODULE_3__.bl.SetBlockAttrs,{id:this.widgetID,attrs:{"custom-setting":JSON.stringify(t)}});0==e.code&&(i.widgetSetting.reload=t.reload,i.widgetSetting.widgetName=t.widgetName,i.widgetSetting.pageSize=t.pageSize,i.widgetSetting.tableCount=t.tableCount,i.widgetSetting.tableCountMode=t.tableCountMode,i.widgetSetting.tableIndex=t.tableIndex,i.widgetSetting.showAttrLabel=t.showAttrLabel,i.widgetSetting.attrFilterReg=t.attrFilterReg);break}}i.fetchLocalNotes().then().catch((e=>{i.loading=!1,element_plus__WEBPACK_IMPORTED_MODULE_7__.z8.error(e.message)}))}filterSelectedNotes(e){const t=[];for(const i of e)t.push({id:i.id,content:_utils_common__WEBPACK_IMPORTED_MODULE_1__.cutString(i.content,20)});return t}handleFilterNameChange(e,t,i=this){const o=i.getFilterOperators(e);i.operators[t]=o,i.filters[t]["operator"]=o[0]["name"],i.filters[t]["value"]="",i.saveSettings(_Types__WEBPACK_IMPORTED_MODULE_3__.Sd.Filters,{data:"null"}),this.fetchLocalNotes()}appendFilterItem(e=this){e.filters.length>5?element_plus__WEBPACK_IMPORTED_MODULE_7__.z8.error("最多只能添加5个筛选条件"):(e.filters.push({name:"content",operator:"contains",value:""}),e.operators.push(e.getFilterOperators("content")))}removeFilterItem(e,t=this){t.filters.splice(e,1),t.fetchLocalNotes()}getFilterOperators(e){const t=[],i=this.attributes.find((t=>t.name==e));if(i)for(const o of _config_config__WEBPACK_IMPORTED_MODULE_5__.D.filter_operators)o.attr_types.indexOf(i.type)>-1&&t.push(o);return t}getSelectSuggestions(e,t,i=this){i.selectSuggestions=[];const o=[],l=i.attributes.find((e=>e.name==t));if(l&&l.options.length>0){const t=l.options;if(e){let l="null";for(const i in t){const a=t[i];a.value.indexOf(e)>-1&&o.push({label:a.value,value:a.value}),a.value==e&&(l="equal")}0!=o.length&&"null"!=l||o.unshift({label:e,value:e}),i.selectSuggestions=o}else i.selectSuggestions=t}}updateOptionInfor(e,t,i,o,l=this){switch(console.log(e,t,i,o),o){case"delete":{console.log("delete");const e=i.options.findIndex((e=>e.value==t.value));i.options.splice(e,1),l.saveWidgtAttrs();break}case"check":{const i=l.attributes.find((t=>t.name==e));i&&(console.log(t.value),console.log(JSON.stringify(i.options)));break}case"value":{const i=l.attributes.find((t=>t.name==e));i&&i.options.forEach((e=>{e.hash==t.hash&&(e.value=t.value,l.saveWidgtAttrs())}));break}case"color":{t.color=i;const o=l.attributes.find((t=>t.name==e));o&&(o.options.forEach((e=>{e.value==t.value&&(e.color=i)})),l.saveWidgtAttrs());break}}}chooseSelectOption(e,t,i,o="select",l="add"){const a=_utils_common__WEBPACK_IMPORTED_MODULE_1__.toArray(t[e.name]);if("add"==l){const l=i;if(a.indexOf(l.value)>-1)element_plus__WEBPACK_IMPORTED_MODULE_7__.z8.warning(`"${l.value}" 已经存在`);else{t[e.name]="select"==o?l.value:t[e.name]?t[e.name]+","+l.value:l.value;const a=e.options.find((e=>e.value==l.value));a||(e.options.push(i),this.saveWidgtAttrs())}}else{const o=a.indexOf(i);o>-1&&a.splice(o,1),t[e.name]=a.join(",")}}async computeSelectOptions(e,t=!1){let i=[];const o=this.attributes.find((t=>t.name==e));if(o){for(const o in this.totalNotes){const l=this.totalNotes[o][e];if(l){const o=l.split(","),a=this.widgetAttrs.find((t=>t.name==e));a&&!t&&(i=a.options);for(const e of o){const t=Math.floor(6*Math.random())+0,o=i.find((t=>t.value==e));o||i.push({value:e,color:_config_config__WEBPACK_IMPORTED_MODULE_5__.D.tag_colors[t]["name"],hash:_utils_common__WEBPACK_IMPORTED_MODULE_1__.randomWord(!0,4,4)})}}}o.options=i,console.log(i),this.saveWidgtAttrs()}else element_plus__WEBPACK_IMPORTED_MODULE_7__.z8.warning(`属性 ${e} 不存在`)}changePage(e){this.currentPage=e,this.pageNotes=this.totalNotes.slice((e-1)*this.widgetSetting.pageSize,e*this.widgetSetting.pageSize)}async clearDatabase(){await _Database__WEBPACK_IMPORTED_MODULE_4__.v.notes.clear(),await this.init(),await this.downloadFromSiyuan(),await this.fetchLocalNotes(),element_plus__WEBPACK_IMPORTED_MODULE_7__.z8.success("缓存已清理")}async resizeTableWidth(e){const t=this.widgetAttrs.find((t=>t.name===e.attrName));t&&(t.width=e.newWidth),_Database__WEBPACK_IMPORTED_MODULE_4__.v.widget_attrs.update(this.widgetID,{attrs:JSON.parse(JSON.stringify(this.widgetAttrs))})}resizeIframe(){const e=window.frameElement,t=window.document.body.scrollHeight;e.style.height=t+50+"px"}async changeViewType(e){this.viewType=e,e==_Types__WEBPACK_IMPORTED_MODULE_3__.bW.Table&&this.loadNotes(),_utils_network__WEBPACK_IMPORTED_MODULE_2__.Xk(_Types__WEBPACK_IMPORTED_MODULE_3__.bl.SetBlockAttrs,{id:this.widgetID,attrs:{"custom-view-type":e}})}}},1944:function(e,t,i){var o=i(9242),l=i(3396),a=i(7139);const s={id:"header"},n={class:"left"},_={key:0,style:{"font-size":"12px",color:"rgb(152, 13, 15)","background-color":"rgba(203, 64, 66, 0.2)",padding:"2px 4px","border-radius":"3px",margin:"0 2px"}},r={key:1,style:{"font-size":"12px",color:"#777",background:"#f3f3f3",padding:"2px 4px","border-radius":"3px",margin:"0 2px"}},d={key:2,style:{"font-size":"12px",color:"#888","margin-left":"5px"}},c={key:3,style:{"font-size":"12px",color:"#e6a23c",background:"#faecd8",padding:"2px 4px","border-radius":"3px",margin:"0 2px"}},u={class:"right"},g=(0,l.Uk)(" 子文档 "),m=(0,l.Uk)(" 自定义 SQL "),p=(0,l.Uk)(" 手动添加 "),w=(0,l.Uk)(" 数据源 "),h={class:"popover-item"},b=(0,l.Uk)(" 展示子文档 "),y={class:"popover-item"},f=(0,l.Uk)(" 自定义 SQL "),v={class:"popover-item"},D=(0,l.Uk)(" 手动添加文档 "),C=(0,l.Uk)(" 表格 "),E=(0,l.Uk)(" 卡片 "),k=(0,l.Uk)(" 列表 "),M=(0,l.Uk)(" 视图 "),O={class:"popover-item flex-between"},P=(0,l.Uk)(" 表格 "),L=(0,l.Uk)("视图设置"),S={class:"popover-item flex-between"},U=(0,l.Uk)(" 卡片 "),W=(0,l.Uk)("视图设置"),V={class:"popover-item flex-between"},T=(0,l.Uk)(" 列表 "),x=(0,l.Uk)("视图设置"),A=(0,l.Uk)(" 属性 "),I=["onClick"],B={class:"attr_item_info"},K={class:"attr_item_name"},R=["innerHTML"],z=["innerHTML"],N={key:0,class:"attr_item_raw"},j={class:"attr_setting"},Z={class:"attr_setting_row"},q=(0,l._)("div",{class:"attr_setting_label"},"展示名称",-1),H={class:"attr_setting_row"},$=(0,l._)("div",{class:"attr_setting_label"},"属性类型",-1),F={style:{display:"flex","align-items":"center"}},Q=["innerHTML"],Y={class:"attr_setting_row"},J=(0,l._)("span",{class:"attr_setting_label"},"属性名：",-1),X={class:"attr_setting_value"},G={class:"attr_setting_row"},ee=(0,l._)("span",{class:"attr_setting_label"},"属性来源：",-1),te={class:"attr_setting_value"},ie=(0,l.Uk)("全局属性设置"),oe=(0,l.Uk)(" 筛选 "),le={key:0},ae=(0,l.Uk)("创建筛选条件"),se={key:1},ne={class:"filter-head"},_e={style:{display:"flex","align-items":"center"}},re=(0,l.Uk)(" 筛选符合下方 "),de={key:0},ce={key:1},ue=(0,l.Uk)(" 条件的数据 "),ge=(0,l.Uk)("全部"),me=(0,l.Uk)("任意"),pe={style:{cursor:"pointer",display:"flex","align-items":"center"}},we=["innerHTML"],he={key:0},be={key:1,class:"filter-row_item filter-row_item_value"},ye=(0,l.Uk)("创建筛选条件"),fe=(0,l.Uk)(" 排序 "),ve=(0,l.Uk)(" 设置 "),De={key:2,style:{display:"flex","justify-content":"center",margin:"15px 0"}};function Ce(e,t,i,Ce,Ee,ke){const Me=(0,l.up)("el-button"),Oe=(0,l.up)("el-popover"),Pe=(0,l.up)("el-switch"),Le=(0,l.up)("el-input"),Se=(0,l.up)("el-option"),Ue=(0,l.up)("el-select"),We=(0,l.up)("draggable"),Ve=(0,l.up)("el-divider"),Te=(0,l.up)("el-scrollbar"),xe=(0,l.up)("el-dropdown-item"),Ae=(0,l.up)("el-dropdown-menu"),Ie=(0,l.up)("el-dropdown"),Be=(0,l.up)("el-input-number"),Ke=(0,l.up)("el-date-picker"),Re=(0,l.up)("el-rate"),ze=(0,l.up)("el-empty"),Ne=(0,l.up)("el-pagination"),je=(0,l.up)("dialog-view");return(0,l.wg)(),(0,l.iD)("div",{onMousemove:t[36]||(t[36]=(...t)=>e.widget.resizeIframe&&e.widget.resizeIframe(...t)),onClick:t[37]||(t[37]=t=>e.togglePopover2("body","menu","close_all"))},[(0,l._)("div",s,[(0,l._)("div",n,[(0,l._)("span",{class:"widget_name",onClick:t[0]||(t[0]=t=>e.toggleDialogVisible("widget_setting"))},(0,a.zw)(e.widget.widgetSetting.widgetName),1),1==e.widget.testMode?((0,l.wg)(),(0,l.iD)("div",_," 测试版本 ")):(0,l.kq)("",!0),"false"==e.widget.widgetSetting.reload?((0,l.wg)(),(0,l.iD)("div",r," 缓存模式 ")):(0,l.kq)("",!0),(0,l.Wm)(Me,{type:"text",style:{color:"#888"},icon:e.icon.Refresh,onClick:e.refresh},null,8,["icon","onClick"]),e.widget.totalNotes.length>0?((0,l.wg)(),(0,l.iD)("span",d," 共 "+(0,a.zw)(e.widget.totalNotes.length)+" 条 ",1)):(0,l.kq)("",!0),e.widget.loading?((0,l.wg)(),(0,l.iD)("div",c," 数据加载中.. ")):(0,l.kq)("",!0)]),(0,l._)("div",u,[(0,l.Wm)(Oe,{trigger:"hover"},{reference:(0,l.w5)((()=>["subdoc"==e.widget.dataSource?((0,l.wg)(),(0,l.j4)(Me,{key:0,type:"text",style:{color:"grey"},icon:e.icon.Folder},{default:(0,l.w5)((()=>[g])),_:1},8,["icon"])):"custom_sql"==e.widget.dataSource?((0,l.wg)(),(0,l.j4)(Me,{key:1,type:"text",style:{color:"grey"},icon:e.icon.Burger,onClick:t[1]||(t[1]=t=>e.toggleDialogVisible("custom_sql"))},{default:(0,l.w5)((()=>[m])),_:1},8,["icon"])):"selected_notes"==e.widget.dataSource?((0,l.wg)(),(0,l.j4)(Me,{key:2,type:"text",style:{color:"grey"},icon:e.icon.Sugar,onClick:t[2]||(t[2]=t=>e.toggleDialogVisible("selected_notes"))},{default:(0,l.w5)((()=>[p])),_:1},8,["icon"])):((0,l.wg)(),(0,l.j4)(Me,{key:3,type:"text",style:{color:"grey"},icon:e.icon.Burger},{default:(0,l.w5)((()=>[w])),_:1},8,["icon"]))])),default:(0,l.w5)((()=>[(0,l._)("div",h,[(0,l.Wm)(Me,{type:"text",style:(0,a.j5)("subdoc"==e.widget.dataSource?"color: #5a9cf8":"color: grey"),icon:e.icon.Folder,onClick:t[3]||(t[3]=t=>e.changeDataSource("subdoc"))},{default:(0,l.w5)((()=>[b])),_:1},8,["style","icon"])]),(0,l._)("div",y,[(0,l.Wm)(Me,{type:"text",style:(0,a.j5)("custom_sql"==e.widget.dataSource?"color: #5a9cf8":"color: grey"),icon:e.icon.Burger,onClick:t[4]||(t[4]=t=>e.toggleDialogVisible("custom_sql"))},{default:(0,l.w5)((()=>[f])),_:1},8,["style","icon"])]),(0,l._)("div",v,[(0,l.Wm)(Me,{type:"text",style:(0,a.j5)("selected_notes"==e.widget.dataSource?"color: #5a9cf8":"color: grey"),icon:e.icon.Sugar,onClick:t[5]||(t[5]=t=>e.toggleDialogVisible("selected_notes"))},{default:(0,l.w5)((()=>[D])),_:1},8,["style","icon"])])])),_:1}),(0,l.Wm)(Oe,{width:160,trigger:"hover"},{reference:(0,l.w5)((()=>["table-view"==e.widget.viewType?((0,l.wg)(),(0,l.j4)(Me,{key:0,type:"text",style:{color:"grey"},icon:e.icon.IceTea},{default:(0,l.w5)((()=>[C])),_:1},8,["icon"])):"card-view"==e.widget.viewType?((0,l.wg)(),(0,l.j4)(Me,{key:1,type:"text",style:{color:"grey"},icon:e.icon.Watermelon},{default:(0,l.w5)((()=>[E])),_:1},8,["icon"])):"list-view"==e.widget.viewType?((0,l.wg)(),(0,l.j4)(Me,{key:2,type:"text",style:{color:"grey"},icon:e.icon.Pear},{default:(0,l.w5)((()=>[k])),_:1},8,["icon"])):((0,l.wg)(),(0,l.j4)(Me,{key:3,icon:e.icon.Soccer,type:"text",style:{color:"grey"}},{default:(0,l.w5)((()=>[M])),_:1},8,["icon"]))])),default:(0,l.w5)((()=>[(0,l._)("div",O,[(0,l.Wm)(Me,{type:"text",style:(0,a.j5)("table-view"==e.widget.viewType?"color: #5a9cf8":"color: grey"),onClick:t[6]||(t[6]=t=>e.widget.saveSettings("view_type",{view_type:"table-view"},e.widget)),icon:e.icon.IceTea},{default:(0,l.w5)((()=>[P])),_:1},8,["style","icon"]),(0,l.Wm)(Me,{class:"view-type-setting",type:"text",size:"small",onClick:t[7]||(t[7]=(0,o.iM)((t=>e.toggleDialogVisible("table_view")),["stop"]))},{default:(0,l.w5)((()=>[L])),_:1})]),(0,l._)("div",S,[(0,l.Wm)(Me,{type:"text",style:(0,a.j5)("card-view"==e.widget.viewType?"color: #5a9cf8":"color: grey"),onClick:t[8]||(t[8]=t=>e.widget.saveSettings("view_type",{view_type:"card-view"},e.widget)),icon:e.icon.Watermelon},{default:(0,l.w5)((()=>[U])),_:1},8,["style","icon"]),(0,l.Wm)(Me,{class:"view-type-setting",type:"text",size:"small",onClick:t[9]||(t[9]=(0,o.iM)((t=>e.toggleDialogVisible("card_view")),["stop"]))},{default:(0,l.w5)((()=>[W])),_:1})]),(0,l._)("div",V,[(0,l.Wm)(Me,{type:"text",style:(0,a.j5)("list-view"==e.widget.viewType?"color: #5a9cf8":"color: grey"),onClick:t[10]||(t[10]=t=>e.widget.saveSettings("view_type",{view_type:"list-view"},e.widget)),icon:e.icon.Pear},{default:(0,l.w5)((()=>[T])),_:1},8,["style","icon"]),(0,l.Wm)(Me,{class:"view-type-setting",type:"text",size:"small",onClick:t[11]||(t[11]=(0,o.iM)((t=>e.toggleDialogVisible("list_view")),["stop"]))},{default:(0,l.w5)((()=>[x])),_:1})])])),_:1}),(0,l.Wm)(Oe,{width:260,visible:e.popoverVisible2.menu.attrs,trigger:"manual",onHide:t[17]||(t[17]=t=>e.widget.saveWidgtAttrs(e.widget))},{reference:(0,l.w5)((()=>[(0,l.Wm)(Me,{type:"text",style:{color:"grey"},icon:e.icon.SetUp,onClick:t[12]||(t[12]=(0,o.iM)((t=>e.togglePopover2("attrs")),["stop"]))},{default:(0,l.w5)((()=>[A])),_:1},8,["icon"])])),default:(0,l.w5)((()=>[(0,l.Wm)(Te,{"max-height":"294px"},{default:(0,l.w5)((()=>[(0,l.Wm)(We,{modelValue:e.widget.attributes,"onUpdate:modelValue":t[15]||(t[15]=t=>e.widget.attributes=t),group:"attrs","item-key":"label"},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.widget.attributes,(i=>((0,l.wg)(),(0,l.j4)(Oe,{key:i["label"],"show-arrow":!1,offset:-2,width:200,trigger:"manual",visible:e.popoverVisible2.submenu["attrs_"+i.name],onHide:t=>e.widget.saveAttrInfor(i)},{reference:(0,l.w5)((()=>[(0,l._)("div",{class:"attr_item",onClick:t=>e.togglePopover2("attrs_"+i.name,"submenu")},[(0,l._)("div",B,[(0,l._)("div",K,[(0,l._)("span",{innerHTML:e.icons["drag"],class:"drag"},null,8,R),(0,l._)("span",{innerHTML:e.icons[i.type||"text"],class:"icon"},null,8,z),(0,l._)("span",null,(0,a.zw)(i.label?i.label:i.name),1)]),(0,l.Wm)(Pe,{modelValue:i.visible,"onUpdate:modelValue":e=>i.visible=e,onClick:t[13]||(t[13]=(0,o.iM)((()=>{}),["stop"])),style:{height:"24px !important"},size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),i.label!=i.name?((0,l.wg)(),(0,l.iD)("div",N,(0,a.zw)(i.name),1)):(0,l.kq)("",!0)],8,I)])),default:(0,l.w5)((()=>[(0,l._)("div",j,[(0,l._)("div",Z,[q,(0,l.Wm)(Le,{modelValue:i.label,"onUpdate:modelValue":e=>i.label=e,placeholder:"展示名称",minlength:"2",maxlength:"30",onUpdate:t[14]||(t[14]=(0,o.iM)((()=>{}),["stop"])),clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),(0,l._)("div",H,[$,(0,l.Wm)(Ue,{modelValue:i.type,"onUpdate:modelValue":e=>i.type=e,style:{width:"100%"}},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.Config.attr_types,((t,i)=>((0,l.wg)(),(0,l.j4)(Se,{key:i,label:t.value,value:t.name,"popper-class":"attr_setting_select_option"},{default:(0,l.w5)((()=>[(0,l._)("div",F,[(0,l._)("span",{innerHTML:e.icons[t.name],class:"icon"},null,8,Q),(0,l.Uk)((0,a.zw)(t.value),1)])])),_:2},1032,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])]),(0,l._)("div",Y,[J,(0,l._)("span",X,(0,a.zw)(i.name),1)]),(0,l._)("div",G,[ee,(0,l._)("span",te,(0,a.zw)("system"==i.source?"系统":"自定义"),1)])])])),_:2},1032,["visible","onHide"])))),128))])),_:1},8,["modelValue"]),(0,l.Wm)(Ve,{style:{margin:"10px 0px 2px 0px !important"}}),(0,l.Wm)(Me,{type:"text",icon:e.icon.Setting,style:{color:"#999"},onClick:t[16]||(t[16]=t=>e.toggleDialogVisible("shared_attrs"))},{default:(0,l.w5)((()=>[ie])),_:1},8,["icon"])])),_:1})])),_:1},8,["visible"]),(0,l.Wm)(Oe,{width:400,class:"filter",visible:e.popoverVisible2.menu.filter,trigger:"manual",onHide:t[31]||(t[31]=t=>e.widget.saveSettings("filters",{data:"null"},e.widget))},{reference:(0,l.w5)((()=>[(0,l.Wm)(Me,{type:"text",icon:e.icon.Filter,style:(0,a.j5)(e.widget.filters.length>0&&"true"==e.widget.filterOn?"color: #5a9cf8":"color: grey"),onClick:t[18]||(t[18]=(0,o.iM)((t=>e.togglePopover2("filter")),["stop"]))},{default:(0,l.w5)((()=>[oe])),_:1},8,["icon","style"])])),default:(0,l.w5)((()=>[0==e.widget.filters.length?((0,l.wg)(),(0,l.iD)("div",le,[(0,l.Wm)(Me,{type:"text",icon:e.icon.CirclePlus,style:{color:"#999"},onClick:t[19]||(t[19]=t=>e.widget.appendFilterItem(e.widget))},{default:(0,l.w5)((()=>[ae])),_:1},8,["icon"])])):((0,l.wg)(),(0,l.iD)("div",se,[(0,l._)("div",ne,[(0,l._)("div",_e,[(0,l.Wm)(Ie,{onCommand:e.handleFilterMode},{dropdown:(0,l.w5)((()=>[(0,l.Wm)(Ae,null,{default:(0,l.w5)((()=>[(0,l.Wm)(xe,{command:"and"},{default:(0,l.w5)((()=>[ge])),_:1}),(0,l.Wm)(xe,{command:"or"},{default:(0,l.w5)((()=>[me])),_:1})])),_:1})])),default:(0,l.w5)((()=>[(0,l._)("span",null,[re,"and"==e.widget.filterMode?((0,l.wg)(),(0,l.iD)("b",de,"全部")):((0,l.wg)(),(0,l.iD)("b",ce,"任意")),(0,l.Wm)(Me,{icon:e.icon.ArrowDown,type:"text",size:"small",style:{color:"grey"}},null,8,["icon"]),ue])])),_:1},8,["onCommand"])]),(0,l.Wm)(Pe,{modelValue:e.widget.filterOn,"onUpdate:modelValue":t[20]||(t[20]=t=>e.widget.filterOn=t),onClick:t[21]||(t[21]=(0,o.iM)((()=>{}),["stop"])),onChange:t[22]||(t[22]=t=>e.widget.saveSettings("filters",{data:"null"},e.widget)),"active-value":"true","inactive-value":"false",size:"small"},null,8,["modelValue"])]),((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.widget.filters,((i,o)=>((0,l.wg)(),(0,l.iD)("div",{class:"filter-row",key:i.name},[(0,l.Wm)(Ue,{modelValue:i.name,"onUpdate:modelValue":e=>i.name=e,class:"filter-row_item filter-row_item_name",onChange:t=>e.widget.handleFilterNameChange(t,o,e.widget)},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.widget.attributes,((t,i)=>((0,l.wg)(),(0,l.j4)(Se,{key:i,label:t.label,value:t.name,"popper-class":"select_option"},{default:(0,l.w5)((()=>[(0,l._)("div",pe,[(0,l._)("span",{innerHTML:e.icons[t.type||"text"],class:"icon"},null,8,we),(0,l.Uk)(" "+(0,a.zw)(t.label||t.name),1)])])),_:2},1032,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),(0,l.Wm)(Ue,{modelValue:i.operator,"onUpdate:modelValue":e=>i.operator=e,class:"filter-row_item filter-row_item_operator",onChange:t[23]||(t[23]=t=>e.widget.saveSettings("filters",{data:"null"},e.widget))},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.widget.operators[o],(e=>((0,l.wg)(),(0,l.j4)(Se,{key:e.name,label:e.label,value:e.name},{default:(0,l.w5)((()=>[(0,l.Uk)((0,a.zw)(e.label),1)])),_:2},1032,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"]),"empty"==e.widget.filters[o]["operator"]||"not_empty"==e.widget.filters[o]["operator"]||"checked"==e.widget.filters[o]["operator"]||"not_checked"==e.widget.filters[o]["operator"]?((0,l.wg)(),(0,l.iD)("div",he)):((0,l.wg)(),(0,l.iD)("div",be,["number"==e.Utils.getAttrType(i.name,e.widget)?((0,l.wg)(),(0,l.j4)(Be,{key:0,modelValue:i.value,"onUpdate:modelValue":e=>i.value=e,controls:!1,onChange:t[24]||(t[24]=t=>e.widget.saveSettings("filters",{data:"null"},e.widget))},null,8,["modelValue","onUpdate:modelValue"])):"date"==e.Utils.getAttrType(i.name,e.widget)?((0,l.wg)(),(0,l.j4)(Ke,{key:1,modelValue:i.value,"onUpdate:modelValue":e=>i.value=e,type:"date",placeholder:"选择日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD HH:mm:ss","prefix-icon":2,clearable:"",onChange:t[25]||(t[25]=t=>e.widget.saveSettings("filters",{data:"null"},e.widget))},null,8,["modelValue","onUpdate:modelValue"])):"rate"==e.Utils.getAttrType(i.name,e.widget)?((0,l.wg)(),(0,l.j4)(Re,{key:2,modelValue:i.value,"onUpdate:modelValue":e=>i.value=e,onChange:t[26]||(t[26]=t=>e.widget.saveSettings("filters",{data:"null"},e.widget))},null,8,["modelValue","onUpdate:modelValue"])):"checkbox"==e.Utils.getAttrType(i.name,e.widget)?((0,l.wg)(),(0,l.j4)(Ue,{key:3,modelValue:i.value,"onUpdate:modelValue":e=>i.value=e,onChange:t[27]||(t[27]=t=>e.widget.saveSettings("filters",{data:"null"},e.widget))},{default:(0,l.w5)((()=>[(0,l.Wm)(Se,{label:"已勾选",value:"true"}),(0,l.Wm)(Se,{label:"未勾选",value:"false"})])),_:2},1032,["modelValue","onUpdate:modelValue"])):"select"==e.Utils.getAttrType(i.name,e.widget)||"multi_select"==e.Utils.getAttrType(i.name,e.widget)?((0,l.wg)(),(0,l.j4)(Ue,{key:4,modelValue:i.value,"onUpdate:modelValue":e=>i.value=e,filterable:"",remote:"",clearable:"","reserve-keyword":"",placeholder:"请输入筛选值","remote-method":e.getSelectSuggestions(i.name,e.widget),loading:e.loading,"default-first-option":!0,onChange:t[28]||(t[28]=t=>e.widget.saveSettings("filters",{data:"null"},e.widget))},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.widget.selectSuggestions,(e=>((0,l.wg)(),(0,l.j4)(Se,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","remote-method","loading"])):((0,l.wg)(),(0,l.j4)(Le,{key:5,modelValue:i.value,"onUpdate:modelValue":e=>i.value=e,class:"filter-row_item",placeholder:"请输入筛选值",onChange:t[29]||(t[29]=t=>e.widget.saveSettings("filters",{data:"null"},e.widget)),clearable:""},null,8,["modelValue","onUpdate:modelValue"]))])),(0,l.Wm)(Me,{type:"text",style:{color:"#999"},icon:e.icon.Close,onClick:t=>e.widget.removeFilterItem(o,e.widget)},null,8,["icon","onClick"])])))),128)),(0,l.Wm)(Ve,{style:{margin:"10px 0px 2px 0px !important"}}),(0,l.Wm)(Me,{type:"text",icon:e.icon.CirclePlus,style:{color:"#999"},onClick:t[30]||(t[30]=t=>e.widget.appendFilterItem(e.widget))},{default:(0,l.w5)((()=>[ye])),_:1},8,["icon"])]))])),_:1},8,["visible"]),(0,l.Wm)(Oe,{width:200,trigger:"click",onHide:t[34]||(t[34]=t=>e.widget.saveSettings("sort",{data:""},e.widget))},{reference:(0,l.w5)((()=>[(0,l.Wm)(Me,{type:"text",style:{color:"grey"},icon:e.icon.Sort},{default:(0,l.w5)((()=>[fe])),_:1},8,["icon"])])),default:(0,l.w5)((()=>[(0,l.Wm)(Ue,{modelValue:e.widget.sortField,"onUpdate:modelValue":t[32]||(t[32]=t=>e.widget.sortField=t),placeholder:"排序方式",style:{width:"100%","margin-bottom":"10px"}},{default:(0,l.w5)((()=>[(0,l.Wm)(Se,{label:"默认排序",value:"default"}),((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.widget.attributes,((e,t)=>((0,l.wg)(),(0,l.j4)(Se,{key:t,label:e.label||e.name,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),(0,l.Wm)(Ue,{modelValue:e.widget.sortType,"onUpdate:modelValue":t[33]||(t[33]=t=>e.widget.sortType=t),placeholder:"排序方式",style:{width:"100%"}},{default:(0,l.w5)((()=>[(0,l.Wm)(Se,{label:"升序",value:"asc"}),(0,l.Wm)(Se,{label:"降序",value:"desc"})])),_:1},8,["modelValue"])])),_:1}),(0,l.Wm)(Me,{type:"text",style:{color:"grey"},icon:e.icon.Setting,onClick:t[35]||(t[35]=t=>e.toggleDialogVisible("widget_setting"))},{default:(0,l.w5)((()=>[ve])),_:1},8,["icon"])])]),e.widget.pageNotes.length>0?((0,l.wg)(),(0,l.j4)((0,l.LL)(e.widget.viewType),{key:0,id:"component",widget:e.widget,notes:e.widget.pageNotes,attributes:e.widget.attributes,popoverVisible:e.popoverVisible2,onDoSomething:e.doSomething},null,8,["widget","notes","attributes","popoverVisible","onDoSomething"])):((0,l.wg)(),(0,l.j4)(ze,{key:1,description:e.widget.loading?"🏃🏻‍♀️ 数据加载中，请稍等片刻...":e.widget.emptyMessage},null,8,["description"])),e.widget.widgetSetting.pageSize>0&&e.widget.totalNotes.length>0?((0,l.wg)(),(0,l.iD)("div",De,[(0,l.Wm)(Ne,{small:"","hide-on-single-page":"",layout:"prev, pager, next",total:e.widget.totalNotes.length,"page-size":e.widget.widgetSetting.pageSize,"current-page":e.widget.currentPage,onCurrentChange:e.handlePageChange},null,8,["total","page-size","current-page","onCurrentChange"])])):(0,l.kq)("",!0),(0,l.Wm)(je,{dialog_visible:e.widget.dialogVisible,type:e.widget.dialogType,widget:e.widget,onCloseDialog:e.toggleDialogVisible,onDoSomething:e.doSomething},null,8,["dialog_visible","type","widget","onCloseDialog","onDoSomething"])],32)}var Ee=i(6598),ke=i(2880);const Me={style:{cursor:"pointer",display:"flex","align-items":"center"}},Oe=["innerHTML"],Pe={key:0,style:{display:"inline-block",width:"4px",height:"4px","border-radius":"4px","margin-left":"3px",background:"rgb(238 146 146)"}},Le={class:"attr_setting"},Se={class:"attr_setting_row"},Ue=(0,l._)("div",{class:"attr_setting_label"},"展示名称",-1),We={class:"attr_setting_row"},Ve=(0,l._)("div",{class:"attr_setting_label"},"属性类型",-1),Te={style:{display:"flex","align-items":"center"}},xe=["innerHTML"],Ae={class:"attr_setting_row"},Ie=(0,l._)("span",{class:"attr_setting_label"},"属性名：",-1),Be={class:"attr_setting_value"},Ke={class:"attr_setting_row"},Re=(0,l._)("span",{class:"attr_setting_label"},"来源：",-1),ze={class:"attr_setting_value"},Ne={class:"attr_setting_row",style:{display:"flex","align-items":"center"}},je=(0,l._)("span",{class:"attr_setting_label"},"列宽：",-1),Ze={class:"attr_setting_value",style:{"margin-bottom":"5px"}},qe=["onClick"],He={key:0},$e={style:{"text-align":"right",cursor:"pointer"}},Fe={key:0,style:{color:"#888"}},Qe={key:1,style:{color:"#ccc"}},Ye={class:"table-count"},Je=["onClick"],Xe={key:0},Ge=["onClick"],et={key:1},tt=["onClick"],it={key:2},ot=["onClick"],lt={key:1},at={key:0},st={key:1},nt=["title","src"],_t=(0,l._)("div",{style:{"margin-bottom":"3px"}},"设置图片地址",-1),rt={key:1},dt=["innerHTML"],ct={key:1},ut={key:2,class:"note_content"},gt=["onClick"],mt={key:3,class:"note_content"},pt=["contenteditable","innerHTML","onBlur"],wt=["onClick"],ht=["contenteditable","innerHTML","onBlur"],bt={key:2},yt={key:3},ft={key:4},vt={key:5},Dt={key:6},Ct={key:0},Et={key:0},kt={key:1},Mt=(0,l.Uk)("<空>"),Ot={key:0},Pt={key:1},Lt=(0,l.Uk)("<空>"),St=["onClick"],Ut={class:"select-suggestion_left"},Wt=["innerHTML"],Vt=(0,l.Uk)("删除"),Tt=(0,l._)("div",{class:"divider"},null,-1),xt=(0,l._)("div",{style:{color:"#999",size:"13px"}},"颜色",-1),At={class:"tag-colors"},It=["onClick"],Bt=["onClick"],Kt=(0,l._)("span",{style:{color:"#999","margin-right":"3px"}},"创建选项",-1),Rt={key:7};function zt(e,t,i,s,n,_){const r=(0,l.up)("el-table-column"),d=(0,l.up)("el-input"),c=(0,l.up)("el-option"),u=(0,l.up)("el-select"),g=(0,l.up)("el-popover"),m=(0,l.up)("el-input-number"),p=(0,l.up)("el-date-picker"),w=(0,l.up)("el-rate"),h=(0,l.up)("el-checkbox"),b=(0,l.up)("el-tag"),y=(0,l.up)("el-button"),f=(0,l.up)("el-scrollbar"),v=(0,l.up)("el-table");return(0,l.wg)(),(0,l.iD)("div",null,[(0,l.Wm)(v,{id:"table-view",data:e.appendNotes,border:"",class:"tabel-view",onHeaderDragend:e.changeColWidth},{default:(0,l.w5)((()=>["true"==e.widget.tableView.tableIndex?((0,l.wg)(),(0,l.j4)(r,{key:0,type:"index","min-width":"40",align:"center",label:"#"})):(0,l.kq)("",!0),((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.visibleAttrs,((i,s)=>((0,l.wg)(),(0,l.j4)(r,{key:s,prop:i.name,label:i.label,width:i["width"]},{header:(0,l.w5)((()=>[(0,l.Wm)(g,{trigger:"click",width:200,"show-arrow":!1,onHide:t=>e.widget.saveAttrInfor(i)},{reference:(0,l.w5)((()=>[(0,l._)("div",Me,[(0,l._)("span",{innerHTML:e.icons[i.type||"text"],class:"icon"},null,8,Oe),(0,l._)("span",null,(0,a.zw)(i.label||i.name),1),"system"==i.source?((0,l.wg)(),(0,l.iD)("span",Pe)):(0,l.kq)("",!0)])])),default:(0,l.w5)((()=>[(0,l._)("div",Le,[(0,l._)("div",Se,[Ue,(0,l.Wm)(d,{modelValue:i.label,"onUpdate:modelValue":e=>i.label=e,placeholder:"请填写展示名称",minlength:"2",maxlength:"30",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),(0,l._)("div",We,[Ve,(0,l.Wm)(u,{modelValue:i.type,"onUpdate:modelValue":e=>i.type=e,style:{width:"100%"},onChange:t[0]||(t[0]=()=>{e.tableCount()})},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.Config.attr_types,((t,i)=>((0,l.wg)(),(0,l.j4)(c,{key:i,label:t.value,value:t.name,"popper-class":"select_option"},{default:(0,l.w5)((()=>[(0,l._)("div",Te,[(0,l._)("span",{innerHTML:e.icons[t.name],class:"icon"},null,8,xe),(0,l.Uk)((0,a.zw)(t.value),1)])])),_:2},1032,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])]),(0,l._)("div",Ae,[Ie,(0,l._)("span",Be,(0,a.zw)(i.name),1)]),(0,l._)("div",Ke,[Re,(0,l._)("span",ze,(0,a.zw)("system"==i.source?"系统属性":"自定义"),1)]),(0,l._)("div",Ne,[je,(0,l._)("span",Ze,[(0,l.Uk)((0,a.zw)(i.width?i.width+" px":"自动宽度")+" ",1),i.width?((0,l.wg)(),(0,l.iD)("span",{key:0,style:{color:"rgb(90, 156, 248)",cursor:"pointer","margin-left":"2px"},onClick:t=>e.deleteColWidth(i)},"设为自动宽度",8,qe)):(0,l.kq)("",!0)])])])])),_:2},1032,["onHide"])])),default:(0,l.w5)((s=>[s.row[i.name]&&String(s.row[i.name]).indexOf("[count]-")>-1?((0,l.wg)(),(0,l.iD)("div",He,[(0,l.Wm)(g,{trigger:"click",placement:"top","show-arrow":!1,width:200},{reference:(0,l.w5)((()=>[(0,l._)("div",$e,[i["count_type"]&&"none"!=i["count_type"]?((0,l.wg)(),(0,l.iD)("div",Fe,(0,a.zw)(e.getCountTypeName(i["count_type"]))+" "+(0,a.zw)(e.getCount(i.name,i["count_type"])),1)):((0,l.wg)(),(0,l.iD)("div",Qe,"统计"))])])),default:(0,l.w5)((()=>[(0,l._)("div",Ye,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.Config.count_types["common"],((t,o)=>((0,l.wg)(),(0,l.iD)("div",{key:o,class:"table-count-item",onClick:t=>e.saveCountType(i,o)},(0,a.zw)(t),9,Je)))),128)),"number"==i.type?((0,l.wg)(),(0,l.iD)("div",Xe,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.Config.count_types["number"],((t,o)=>((0,l.wg)(),(0,l.iD)("div",{key:o,class:"table-count-item",onClick:t=>e.saveCountType(i,o)},(0,a.zw)(t),9,Ge)))),128))])):(0,l.kq)("",!0),"date"==i.type?((0,l.wg)(),(0,l.iD)("div",et,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.Config.count_types["date"],((t,o)=>((0,l.wg)(),(0,l.iD)("div",{key:o,class:"table-count-item",onClick:t=>e.saveCountType(i,o)},(0,a.zw)(t),9,tt)))),128))])):(0,l.kq)("",!0),"checkbox"==i.type?((0,l.wg)(),(0,l.iD)("div",it,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.Config.count_types["checkbox"],((t,o)=>((0,l.wg)(),(0,l.iD)("div",{key:o,class:"table-count-item",onClick:t=>e.saveCountType(i,o)},(0,a.zw)(t),9,ot)))),128))])):(0,l.kq)("",!0)])])),_:2},1024)])):((0,l.wg)(),(0,l.iD)("div",lt,["img"==i.type?((0,l.wg)(),(0,l.iD)("div",at,[(0,l.Wm)(g,{trigger:"click",width:350},{reference:(0,l.w5)((()=>["title_img"==i.name?((0,l.wg)(),(0,l.iD)("div",{key:0,style:(0,a.j5)([{width:"100%","min-height":"80px","border-radius":"2px",cursor:"pointer"},s.row[i.name]||"background:#f3f3f3;"])},null,4)):((0,l.wg)(),(0,l.iD)("div",st,[(0,l._)("img",{title:s.row[i.name],src:s.row[i.name]?s.row[i.name].indexOf("http")>-1?s.row[i.name]:e.Config.host+"/"+s.row[i.name]:"",style:(0,a.j5)([{width:"100%","min-height":"50px","border-radius":"2px",display:"inline-block",cursor:"pointer"},s.row[i.name]||"background:#f3f3f3;"])},null,12,nt)]))])),default:(0,l.w5)((()=>[_t,(0,l.Wm)(d,{modelValue:s.row[i.name],"onUpdate:modelValue":e=>s.row[i.name]=e,placeholder:"支持网络图片或思源笔记附件(assets)地址",clearable:"",onChange:t=>e.widget.saveAttrValue(s.row.block_id,s.row.type,i.name,s.row[i.name],e.widget)},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:2},1024)])):"text"==i.type?((0,l.wg)(),(0,l.iD)("div",rt,["markdown"==i.name?((0,l.wg)(),(0,l.iD)("div",{key:0,innerHTML:e.Markdown(s.row[i.name]).replaceAll("assets/",e.Config.host+"/assets/"),class:"col-markdown"},null,8,dt)):["id","block_id","box","fold","title_img","type","created","updated","hpath"].indexOf(i.name)>-1?((0,l.wg)(),(0,l.iD)("div",ct,(0,a.zw)(s.row[i.name]),1)):"title"==i.name?((0,l.wg)(),(0,l.iD)("div",ut,[(0,l.Wm)(d,{modelValue:s.row[i.name],"onUpdate:modelValue":e=>s.row[i.name]=e,class:"noborder",onChange:t=>e.widget.saveAttrValue(s.row.block_id,s.row.type,i.name,s.row[i.name],e.widget),disabled:-1==["文档"].indexOf(s.row.type)},null,8,["modelValue","onUpdate:modelValue","onChange","disabled"]),(0,l._)("div",{onClick:t=>e.Utils.openNote(s.row.block_id),class:"open_note"}," 打开 ",8,gt)])):"content"==i.name?((0,l.wg)(),(0,l.iD)("div",mt,[(0,l._)("div",{contenteditable:-1==["文档","列表","超级块"].indexOf(s.row.type),innerHTML:s.row[i.name],class:"lz-textarea",ref_for:!0,ref:s.row.id+i.name,onBlur:t=>e.saveTextarea(s.row.id,i.name)},null,40,pt),(0,l._)("div",{onClick:t=>e.Utils.openNote(s.row.block_id),class:"open_note"}," 打开 ",8,wt)])):((0,l.wg)(),(0,l.iD)("div",{key:4,contenteditable:"system"!=i.source,innerHTML:s.row[i.name],class:"lz-textarea",ref_for:!0,ref:s.row.id+i.name,onBlur:t=>e.saveTextarea(s.row.id,i.name)},null,40,ht))])):"number"==i.type?((0,l.wg)(),(0,l.iD)("div",bt,[(0,l.Wm)(m,{modelValue:s.row[i.name],"onUpdate:modelValue":e=>s.row[i.name]=e,controls:!1,class:"noborder table-view",disabled:"system"==i.source,onChange:t=>e.widget.saveAttrValue(s.row.block_id,s.row.type,i.name,s.row[i.name],e.widget)},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"])])):"date"==i.type?((0,l.wg)(),(0,l.iD)("div",yt,[(0,l.Wm)(p,{modelValue:s.row[i.name],"onUpdate:modelValue":e=>s.row[i.name]=e,type:"date",placeholder:"设置日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD HH:mm:ss",class:"noborder",style:{width:"130px"},disabled:"system"==i.source,onChange:t=>e.widget.saveAttrValue(s.row.block_id,s.row.type,i.name,s.row[i.name],e.widget)},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"])])):"rate"==i.type?((0,l.wg)(),(0,l.iD)("div",ft,[(0,l.Wm)(w,{modelValue:s.row[i.name],"onUpdate:modelValue":e=>s.row[i.name]=e,disabled:"system"==i.source,onChange:t=>e.widget.saveAttrValue(s.row.block_id,s.row.type,i.name,s.row[i.name],e.widget)},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"])])):"checkbox"==i.type?((0,l.wg)(),(0,l.iD)("div",vt,[(0,l.Wm)(h,{modelValue:s.row[i.name],"onUpdate:modelValue":e=>s.row[i.name]=e,"true-label":"true","false-label":"false",disabled:"system"==i.source,onChange:t=>e.widget.saveAttrValue(s.row.block_id,s.row.type,i.name,s.row[i.name],e.widget)},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"])])):"select"==i.type||"multi_select"==i.type?((0,l.wg)(),(0,l.iD)("div",Dt,["system"==i.source&&("tags"==i.name&&"d"!=s.row["type"]||"tags"!=i.name)?((0,l.wg)(),(0,l.iD)("div",Ct,[e.Utils.toArray(s.row[i.name]).length>0?((0,l.wg)(),(0,l.iD)("span",Et,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.Utils.toArray(s.row[i.name]),(t=>((0,l.wg)(),(0,l.iD)("span",{key:t},[(0,l.Wm)(b,{class:(0,a.C_)(["select",e.Utils.tagStyle(t,i.name,e.attributes)])},{default:(0,l.w5)((()=>[(0,l.Uk)((0,a.zw)(t),1)])),_:2},1032,["class"])])))),128))])):((0,l.wg)(),(0,l.iD)("span",kt,[(0,l.Wm)(b,{class:"select grey"},{default:(0,l.w5)((()=>[Mt])),_:1})]))])):((0,l.wg)(),(0,l.j4)(g,{key:1,trigger:"manual",visible:e.popoverVisible["menu"]["table_"+s.row.block_id+i.name],width:250,"show-arrow":!1,offset:-22,onShow:e.initNewOption,onHide:t=>e.saveSelectOptions(s.row,i)},{reference:(0,l.w5)((()=>[e.Utils.toArray(s.row[i.name]).length>0?((0,l.wg)(),(0,l.iD)("span",Ot,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.Utils.toArray(s.row[i.name]),(t=>((0,l.wg)(),(0,l.iD)("span",{key:t},[(0,l.Wm)(b,{class:(0,a.C_)(["select",e.Utils.tagStyle(t,i.name,e.attributes)]),onClick:(0,o.iM)((t=>e.togglePopover(`table_${s.row.block_id}${i.name}`)),["stop"])},{default:(0,l.w5)((()=>[(0,l.Uk)((0,a.zw)(t),1)])),_:2},1032,["class","onClick"])])))),128))])):((0,l.wg)(),(0,l.iD)("span",Pt,[(0,l.Wm)(b,{class:"select grey",onClick:(0,o.iM)((t=>e.togglePopover(`table_${s.row.block_id}${i.name}`)),["stop"])},{default:(0,l.w5)((()=>[Lt])),_:2},1032,["onClick"])]))])),default:(0,l.w5)((()=>[(0,l._)("div",null,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.Utils.toArray(s.row[i.name]),(t=>((0,l.wg)(),(0,l.iD)("span",{key:t},[(0,l.Wm)(b,{class:(0,a.C_)(["select",e.Utils.tagStyle(t,i.name,e.attributes)]),closable:"",onClose:o=>e.chooseSelectOption(i,s.row,t,i.type,"remove")},{default:(0,l.w5)((()=>[(0,l.Uk)((0,a.zw)(t),1)])),_:2},1032,["class","onClose"])])))),128))]),(0,l.Wm)(d,{modelValue:e.newSelectOption.value,"onUpdate:modelValue":t[1]||(t[1]=t=>e.newSelectOption.value=t),autofocus:!0,placeholder:"查找或创建选项",style:{margin:"5px 0"},onKeyup:(0,o.D2)((t=>e.chooseSelectOption(i,s.row,e.newSelectOption,i.type,"add")),["enter"]),clearable:""},null,8,["modelValue","onKeyup"]),(0,l.Wm)(f,{"max-height":"212px"},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.queryOptions(e.newSelectOption.value,i.name),(n=>((0,l.wg)(),(0,l.iD)("div",{key:n,class:"select-suggestion",onClick:t=>e.chooseSelectOption(i,s.row,n,i.type,"add")},[(0,l._)("div",Ut,[(0,l.Wm)(b,{class:"select","data-hash":n.hash,style:(0,a.j5)(e.Utils.selectOptionStyle(n.color))},{default:(0,l.w5)((()=>[(0,l.Uk)((0,a.zw)(e.Utils.cutString(n.value,14)),1)])),_:2},1032,["data-hash","style"])]),(0,l.Wm)(g,{placement:"right",width:200,trigger:"click","show-arrow":!1,class:"select-suggestion_right"},{reference:(0,l.w5)((()=>[(0,l._)("span",{innerHTML:e.icons["dots"],class:"icon",onClick:t[2]||(t[2]=(0,o.iM)((()=>{}),["stop"]))},null,8,Wt)])),default:(0,l.w5)((()=>[(0,l._)("div",null,[(0,l.Wm)(d,{modelValue:n.value,"onUpdate:modelValue":e=>n.value=e,placeholder:"输入选项值",style:{"margin-bottom":"5px"},clearable:"",onInput:t=>e.widget.updateOptionInfor(i.name,n,i,"check",e.widget),onChange:t=>e.widget.updateOptionInfor(i.name,n,i,"value",e.widget)},null,8,["modelValue","onUpdate:modelValue","onInput","onChange"]),(0,l.Wm)(y,{type:"warning",size:"small",icon:e.ElementIcons.Delete,plain:"",onClick:(0,o.iM)((t=>e.widget.updateOptionInfor(i.name,n,i,"delete",e.widget)),["stop"])},{default:(0,l.w5)((()=>[Vt])),_:2},1032,["icon","onClick"]),Tt,xt,(0,l._)("div",At,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.Config.tag_colors,(t=>((0,l.wg)(),(0,l.iD)("div",{class:"tag-colors-item",key:t},[(0,l._)("div",{class:"tag-colors-item_inner",style:(0,a.j5)(`background: ${t.background};border:1px solid rgba(0,0,0,.06)`),onClick:o=>e.widget.updateOptionInfor(i.name,n,t.name,"color",e.widget)},[n.color==t.name?((0,l.wg)(),(0,l.j4)(y,{key:0,type:"text",style:(0,a.j5)(`color: ${t.color}`),size:"large",icon:e.ElementIcons.Check,circle:""},null,8,["style","icon"])):(0,l.kq)("",!0)],12,It)])))),128))])])])),_:2},1024)],8,St)))),128)),e.newSelectOption.value?((0,l.wg)(),(0,l.iD)("div",{key:0,class:"select-suggestion",onClick:t=>e.chooseSelectOption(i,s.row,e.newSelectOption,i.type,"add")},[(0,l._)("div",null,[Kt,(0,l.Wm)(b,{class:(0,a.C_)(["select",e.newSelectOption.color]),"data-hash":e.newSelectOption.hash},{default:(0,l.w5)((()=>[(0,l.Uk)((0,a.zw)(e.newSelectOption.value),1)])),_:1},8,["data-hash","class"])])],8,Bt)):(0,l.kq)("",!0)])),_:2},1024)])),_:2},1032,["visible","onShow","onHide"]))])):((0,l.wg)(),(0,l.iD)("div",Rt,(0,a.zw)(s.row[i.name]),1))]))])),_:2},1032,["prop","label","width"])))),128))])),_:1},8,["data","onHeaderDragend"])])}const Nt={text:'<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 14 14"  style="display: block; fill: #666; flex-shrink: 0; backface-visibility: hidden;"><path d="M7,4.56818 C7,4.29204 6.77614,4.06818 6.5,4.06818 L0.5,4.06818 C0.223858,4.06818 0,4.29204 0,4.56818 L0,5.61364 C0,5.88978 0.223858,6.11364 0.5,6.11364 L6.5,6.11364 C6.77614,6.11364 7,5.88978 7,5.61364 L7,4.56818 Z M0.5,1 C0.223858,1 0,1.223858 0,1.5 L0,2.54545 C0,2.8216 0.223858,3.04545 0.5,3.04545 L12.5,3.04545 C12.7761,3.04545 13,2.8216 13,2.54545 L13,1.5 C13,1.223858 12.7761,1 12.5,1 L0.5,1 Z M0,8.68182 C0,8.95796 0.223858,9.18182 0.5,9.18182 L11.5,9.18182 C11.7761,9.18182 12,8.95796 12,8.68182 L12,7.63636 C12,7.36022 11.7761,7.13636 11.5,7.13636 L0.5,7.13636 C0.223858,7.13636 0,7.36022 0,7.63636 L0,8.68182 Z M0,11.75 C0,12.0261 0.223858,12.25 0.5,12.25 L9.5,12.25 C9.77614,12.25 10,12.0261 10,11.75 L10,10.70455 C10,10.4284 9.77614,10.20455 9.5,10.20455 L0.5,10.20455 C0.223858,10.20455 0,10.4284 0,10.70455 L0,11.75 Z"></path></svg>',checkbox:'<svg xmlns="http://www.w3.org/2000/svg" version="1.1"  viewBox="0 0 14 14"  style="display: block; fill: #666; flex-shrink: 0; backface-visibility: hidden;"><path d="M0,3 C0,1.34314 1.34326,0 3,0 L11,0 C12.6567,0 14,1.34314 14,3 L14,11 C14,12.6569 12.6567,14 11,14 L3,14 C1.34326,14 0,12.6569 0,11 L0,3 Z M3,1.5 C2.17139,1.5 1.5,2.17157 1.5,3 L1.5,11 C1.5,11.8284 2.17139,12.5 3,12.5 L11,12.5 C11.8286,12.5 12.5,11.8284 12.5,11 L12.5,3 C12.5,2.17157 11.8286,1.5 11,1.5 L3,1.5 Z M2.83252,6.8161 L3.39893,6.27399 L3.57617,6.10425 L3.92334,5.77216 L4.26904,6.10559 L4.44531,6.27582 L5.58398,7.37402 L9.28271,3.81073 L9.45996,3.64008 L9.80664,3.3056 L10.1538,3.63989 L10.3311,3.81067 L10.8936,4.35303 L11.0708,4.52399 L11.4434,4.88379 L11.0708,5.24353 L10.8936,5.41437 L6.1084,10.0291 L5.93115,10.2 L5.58398,10.5344 L5.23682,10.2 L5.05957,10.0292 L2.83057,7.87946 L2.65283,7.70801 L2.27832,7.34674 L2.6543,6.98694 L2.83252,6.8161 Z"></path></svg>',number:'<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 14 14"  style="display: block; fill: #666; flex-shrink: 0; backface-visibility: hidden;"><path d="M4.46191,0 C3.8667,0 3.38428,0.482422 3.38428,1.07751 L3.38428,3.38425 L1.07764,3.38425 C0.482422,3.38425 0,3.86667 0,4.46179 C0,5.05688 0.482422,5.53931 1.07764,5.53931 L3.38428,5.53931 L3.38428,8.46063 L1.07764,8.46063 C0.482422,8.46063 0,8.94308 0,9.53818 C0,10.1333 0.482422,10.6157 1.07764,10.6157 L3.38428,10.6157 L3.38428,12.9224 C3.38428,13.5175 3.8667,13.9999 4.46191,13.9999 C5.05664,13.9999 5.53906,13.5175 5.53906,12.9224 L5.53906,10.6157 L8.46045,10.6157 L8.46045,12.9224 C8.46045,13.5175 8.94287,13.9999 9.53809,13.9999 C10.1333,13.9999 10.6157,13.5175 10.6157,12.9224 L10.6157,10.6157 L12.9224,10.6157 C13.5176,10.6157 14,10.1333 14,9.53818 C14,8.94308 13.5176,8.46063 12.9224,8.46063 L10.6157,8.46063 L10.6157,5.53931 L12.9224,5.53931 C13.5176,5.53931 14,5.05688 14,4.46179 C14,3.86667 13.5176,3.38425 12.9224,3.38425 L10.6157,3.38425 L10.6157,1.07751 C10.6157,0.482422 10.1333,0 9.53809,0 C8.94287,0 8.46045,0.482422 8.46045,1.07751 L8.46045,3.38425 L5.53906,3.38425 L5.53906,1.07751 C5.53906,0.482422 5.05664,0 4.46191,0 Z M5.53906,8.46063 L5.53906,5.53931 L8.46045,5.53931 L8.46045,8.46063 L5.53906,8.46063 Z"></path></svg>',date:'<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 14 14"  style=" display: block; fill: #666; flex-shrink: 0; backface-visibility: hidden;"><path d="M10.8889,5.5 L3.11111,5.5 L3.11111,7.05556 L10.8889,7.05556 L10.8889,5.5 Z M12.4444,1.05556 L11.6667,1.05556 L11.6667,0 L10.1111,0 L10.1111,1.05556 L3.88889,1.05556 L3.88889,0 L2.33333,0 L2.33333,1.05556 L1.55556,1.05556 C0.692222,1.05556 0.00777777,1.75556 0.00777777,2.61111 L0,12.5 C0,13.3556 0.692222,14 1.55556,14 L12.4444,14 C13.3,14 14,13.3556 14,12.5 L14,2.61111 C14,1.75556 13.3,1.05556 12.4444,1.05556 Z M12.4444,12.5 L1.55556,12.5 L1.55556,3.94444 L12.4444,3.94444 L12.4444,12.5 Z M8.55556,8.61111 L3.11111,8.61111 L3.11111,10.1667 L8.55556,10.1667 L8.55556,8.61111 Z"></path></svg>',drag:'<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 10 10" style="display: block; fill: rgba(55, 53, 47, 0.45); flex-shrink: 0; backface-visibility: hidden;"><path d="M3,2 C2.44771525,2 2,1.55228475 2,1 C2,0.44771525 2.44771525,0 3,0 C3.55228475,0 4,0.44771525 4,1 C4,1.55228475 3.55228475,2 3,2 Z M3,6 C2.44771525,6 2,5.55228475 2,5 C2,4.44771525 2.44771525,4 3,4 C3.55228475,4 4,4.44771525 4,5 C4,5.55228475 3.55228475,6 3,6 Z M3,10 C2.44771525,10 2,9.55228475 2,9 C2,8.44771525 2.44771525,8 3,8 C3.55228475,8 4,8.44771525 4,9 C4,9.55228475 3.55228475,10 3,10 Z M7,2 C6.44771525,2 6,1.55228475 6,1 C6,0.44771525 6.44771525,0 7,0 C7.55228475,0 8,0.44771525 8,1 C8,1.55228475 7.55228475,2 7,2 Z M7,6 C6.44771525,6 6,5.55228475 6,5 C6,4.44771525 6.44771525,4 7,4 C7.55228475,4 8,4.44771525 8,5 C8,5.55228475 7.55228475,6 7,6 Z M7,10 C6.44771525,10 6,9.55228475 6,9 C6,8.44771525 6.44771525,8 7,8 C7.55228475,8 8,8.44771525 8,9 C8,9.55228475 7.55228475,10 7,10 Z"></path></svg>',select:'<svg viewBox="0 0 14 14" style="width: 14px; height: 14px; display: block; fill: rgba(55, 53, 47, 0.45); flex-shrink: 0; backface-visibility: hidden;"><path d="M7,13 C10.31348,13 13,10.31371 13,7 C13,3.68629 10.31348,1 7,1 C3.68652,1 1,3.68629 1,7 C1,10.31371 3.68652,13 7,13 Z M3.75098,5.32278 C3.64893,5.19142 3.74268,5 3.90869,5 L10.09131,5 C10.25732,5 10.35107,5.19142 10.24902,5.32278 L7.15771,9.29703 C7.07764,9.39998 6.92236,9.39998 6.84229,9.29703 L3.75098,5.32278 Z"></path></svg>',multi_select:'<svg viewBox="0 0 14 14"  style="width: 14px; height: 14px; display: block; fill: rgba(55, 53, 47, 0.45); flex-shrink: 0; backface-visibility: hidden;"><path d="M4,3 C4,2.447715 4.447715,2 5,2 L12,2 C12.5523,2 13,2.447716 13,3 C13,3.55228 12.5523,4 12,4 L5,4 C4.447715,4 4,3.55228 4,3 Z M4,7 C4,6.447715 4.447715,6 5,6 L12,6 C12.5523,6 13,6.447716 13,7 C13,7.55228 12.5523,8 12,8 L5,8 C4.447715,8 4,7.55228 4,7 Z M4,11 C4,10.447715 4.447715,10 5,10 L12,10 C12.5523,10 13,10.447716 13,11 C13,11.55228 12.5523,12 12,12 L5,12 C4.447715,12 4,11.55228 4,11 Z M2,4 C1.44771525,4 1,3.55228475 1,3 C1,2.44771525 1.44771525,2 2,2 C2.55228475,2 3,2.44771525 3,3 C3,3.55228475 2.55228475,4 2,4 Z M2,8 C1.44771525,8 1,7.55228475 1,7 C1,6.44771525 1.44771525,6 2,6 C2.55228475,6 3,6.44771525 3,7 C3,7.55228475 2.55228475,8 2,8 Z M2,12 C1.44771525,12 1,11.5522847 1,11 C1,10.4477153 1.44771525,10 2,10 C2.55228475,10 3,10.4477153 3,11 C3,11.5522847 2.55228475,12 2,12 Z"></path></svg>',rate:'<svg viewBox="0 0 32 32" style="width: 14px; height: 14px; display: block; fill: rgba(55, 53, 47, 0.45); flex-shrink: 0; backface-visibility: hidden;">\n  <path d="M15.1203 1.70752C15.3972 0.855311 16.6028 0.85531 16.8797 1.70752L19.8336 10.7985C19.9574 11.1797 20.3126 11.4377 20.7133 11.4377H30.2722C31.1682 11.4377 31.5408 12.5843 30.8159 13.111L23.0826 18.7296C22.7584 18.9651 22.6227 19.3826 22.7466 19.7638L25.7004 28.8548C25.9773 29.707 25.0019 30.4157 24.277 29.889L16.5437 24.2704C16.2195 24.0349 15.7805 24.0349 15.4563 24.2704L7.72302 29.889C6.99809 30.4157 6.02269 29.707 6.29959 28.8548L9.25344 19.7638C9.37727 19.3827 9.24162 18.9651 8.91742 18.7296L1.18414 13.111C0.459205 12.5843 0.831771 11.4377 1.72784 11.4377H11.2867C11.6874 11.4377 12.0426 11.1797 12.1664 10.7985L15.1203 1.70752Z" />\n  </svg>  ',dots:'<svg viewBox="0 0 13 3" style="width: 12px; height: 100%; display: block; fill: rgba(55, 53, 47, 0.45); flex-shrink: 0; backface-visibility: hidden;"><g><path d="M3,1.5A1.5,1.5,0,1,1,1.5,0,1.5,1.5,0,0,1,3,1.5Z"></path><path d="M8,1.5A1.5,1.5,0,1,1,6.5,0,1.5,1.5,0,0,1,8,1.5Z"></path><path d="M13,1.5A1.5,1.5,0,1,1,11.5,0,1.5,1.5,0,0,1,13,1.5Z"></path></g></svg>',img:'<svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2067" xmlns:xlink="http://www.w3.org/1999/xlink" style="width: 14px; height: 14px; display: block; fill: rgba(55, 53, 47, 0.45); flex-shrink: 0; backface-visibility: hidden;"><path d="M867.90864 574.538232V257.779543a50.844091 50.844091 0 0 0-50.844092-50.844091h-610.129096a50.844091 50.844091 0 0 0-50.844092 50.844091v499.797418l430.141013-257.779543a152.532274 152.532274 0 0 1 157.108243 0z m0 118.466733l-177.445879-106.264151a50.844091 50.844091 0 0 0-50.844092 0L254.220457 817.064548h562.844091a50.844091 50.844091 0 0 0 50.844092-50.844091z m-660.973188-587.757696h610.129096a152.532274 152.532274 0 0 1 152.532274 152.532274v508.440914a152.532274 152.532274 0 0 1-152.532274 152.532274h-610.129096a152.532274 152.532274 0 0 1-152.532274-152.532274v-508.440914a152.532274 152.532274 0 0 1 152.532274-152.532274z m127.110228 355.90864a76.266137 76.266137 0 1 1 76.266137-76.266137 76.266137 76.266137 0 0 1-76.266137 76.266137z" fill="#666666" p-id="2068"></path></svg>',url:'<svg viewBox="0 0 14 14"  style="width: 14px; height: 14px; display: block; fill: rgba(55, 53, 47, 0.45);flex-shrink: 0; backface-visibility: hidden;"><path d="M3.73333,3.86667 L7.46667,3.86667 C8.49613,3.86667 9.33333,4.70387 9.33333,5.73333 C9.33333,6.7628 8.49613,7.6 7.46667,7.6 L6.53333,7.6 C6.01813,7.6 5.6,8.0186 5.6,8.53333 C5.6,9.04807 6.01813,9.46667 6.53333,9.46667 L7.46667,9.46667 C9.5284,9.46667 11.2,7.79507 11.2,5.73333 C11.2,3.6716 9.5284,2 7.46667,2 L3.73333,2 C1.6716,2 0,3.6716 0,5.73333 C0,7.124 0.762067,8.33453 1.88953,8.97713 C1.87553,8.83107 1.86667,8.6836 1.86667,8.53333 C1.86667,7.92013 1.98753,7.33447 2.2036,6.7978 C1.99267,6.4954 1.86667,6.12953 1.86667,5.73333 C1.86667,4.70387 2.70387,3.86667 3.73333,3.86667 Z M12.1095,5.28907 C12.1231,5.4356 12.1333,5.58307 12.1333,5.73333 C12.1333,6.34607 12.0101,6.9294 11.7931,7.46513 C12.0059,7.768 12.1333,8.13573 12.1333,8.53333 C12.1333,9.5628 11.2961,10.4 10.2667,10.4 L6.53333,10.4 C5.50387,10.4 4.66667,9.5628 4.66667,8.53333 C4.66667,7.50387 5.50387,6.66667 6.53333,6.66667 L7.46667,6.66667 C7.98187,6.66667 8.4,6.24807 8.4,5.73333 C8.4,5.2186 7.98187,4.8 7.46667,4.8 L6.53333,4.8 C4.4716,4.8 2.8,6.4716 2.8,8.53333 C2.8,10.59507 4.4716,12.2667 6.53333,12.2667 L10.2667,12.2667 C12.3284,12.2667 14,10.59507 14,8.53333 C14,7.14267 13.2375,5.93167 12.1095,5.28907 Z"></path></svg>'};var jt=i(6583),Zt=i(5068),qt=i(7573),Ht=(0,l.aZ)({name:"TableView",props:{widget:ke.Z,notes:[],attributes:[],popoverVisible:{}},data(){return{icons:Nt,Utils:jt,Config:qt.D,ElementIcons:Ee,Markdown:Zt.TU.parse,counts:[],optionValue:"",newSelectOption:{value:"",color:"",hash:""},popoverVisible2:{select:!1,multi_select:!1}}},computed:{visibleAttrs(){return this.widget.attributes.filter((e=>e.visible))},appendNotes(){if("true"==this.widget.tableView.tableCount){const e={};return this.attributes.forEach((t=>{e[t.name]="[count]-"+t.name})),this.notes.concat([e])}return this.notes}},watch:{notes:{handler(e){this.tableCount(e)},deep:!0}},methods:{initNewOption(){const e=Math.floor(8*Math.random())+0;this.newSelectOption={value:"",color:qt.D.tag_colors[e]["name"],hash:jt.randomWord(!0,4,4)}},queryOptions(e,t){const i=this.widget.widgetAttrs.find((e=>e.name==t)).options;return i?i.filter((t=>t.value.indexOf(e)>-1)):[]},chooseSelectOption(e,t,i,o="select",l="add"){this.widget.chooseSelectOption(e,t,i,o,l),this.initNewOption()},saveSelectOptions(e,t){console.log("save select options:",e,t),this.newSelectOption.value="",this.widget.saveAttrValue(e.block_id,e.type,t.name,e[t.name])},saveTextarea(e,t){const i=this.$refs[e+t],o=i[0];if(o&&o.innerText){const i=o.innerText;console.log("save textarea",e,t),this.widget.saveAttrValue(e,"text",t,i)}},saveCountType(e,t){const i=e;i.count_type=t,this.widget.saveWidgtAttrs()},getCountTypeName(e){let t="统计";const i=this.Config.count_types;for(const o in i){const l=i[o],a=l[e];if(a){t=a;break}}return t},getCount(e,t){const i=this.counts.find((t=>t.attr_name==e));return i?i[t]:0},tableCount(e){e=e||this.appendNotes;const t=[];if(this.attributes.length>0){for(let e=0;e<this.attributes.length;e++){const i=this.attributes[e],o={attr_name:i.name,attr_label:i.label,total_count:0,unique:0,with_value:0,without_value:0,null_percent:"0",not_null_percent:"0",done:0,undone:0,sum:0,avg:0,max:0,min:0,range:0,most_early:"",most_late:""};let l=0,a=0,s="",n="",_=new Set;const r="page"==this.widget.tableView.tableCountMode?this.notes:this.widget.totalNotes;for(let e=0;e<r.length;e++){const t=r[e],d=t[i.name];o.total_count++,null!=d&&""!=d&&void 0!=d?(o.with_value++,_.add(d),"checkbox"==i.type&&"true"==d?o.done++:o.undone++,"number"==i.type&&(o.sum+=parseFloat(d),parseFloat(d)>l&&(l=parseFloat(d)),parseFloat(d)<a&&(a=parseFloat(d))),"date"==i.type&&(s=s||d,n=n||d,d>n&&(n=d),d<s&&(s=d))):(o.without_value++,o.undone++)}o.null_percent=String((o.without_value/o.total_count*100).toFixed(2))+"%",o.not_null_percent=(o.with_value/o.total_count*100).toFixed(2)+"%",o.avg=parseFloat((o.sum/o.with_value).toFixed(2)),o.unique=_.size,o.max=l,o.min=a,o.range=o.max-o.min,o.most_early=s,o.most_late=n,t.push(o)}this.counts=t}},getOptions(e){if(e){const t=this.widget.attributes.find((t=>t.name==e));return t?t.options:[]}return[]},togglePopover(e,t="menu",i="toggle"){this.$emit("doSomething","toggle_popover",{menuName:e,type:t,action:i})},changeColWidth(e,t,i,o){this.$emit("doSomething","resize_table_width",{attrName:i.property,newWidth:e})},deleteColWidth(e){this.$emit("doSomething","resize_table_width",{attrName:e.name,newWidth:""}),e.width=""}},created(){this.tableCount(this.appendNotes)},mounted(){console.log("table mounted"),setTimeout((()=>{this.$emit("doSomething","resize_iframe")}),500)}}),$t=i(89);const Ft=(0,$t.Z)(Ht,[["render",zt]]);var Qt=Ft;const Yt={class:"card-list"},Jt=["onClick"],Xt={key:1,class:"cover"},Gt=["title","src"],ei={style:{padding:"14px"}},ti={class:"card-item-title"},ii={key:0,class:"card-item-attrs"},oi={key:0,style:{color:"grey"}},li={key:3},ai={key:4};function si(e,t,i,s,n,_){const r=(0,l.up)("el-checkbox"),d=(0,l.up)("el-rate"),c=(0,l.up)("el-tag");return(0,l.wg)(),(0,l.iD)("div",Yt,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.notes,(i=>((0,l.wg)(),(0,l.iD)("div",{key:i.id,onClick:t=>e.Utils.openNote(i.block_id),class:"card-item"},["title_img"==e.widget.cardView.coverAttr?((0,l.wg)(),(0,l.iD)("div",{key:0,class:"cover",style:(0,a.j5)(i["title_img"])},null,4)):((0,l.wg)(),(0,l.iD)("div",Xt,[(0,l._)("img",{title:i[e.widget.cardView.coverAttr],src:i[e.widget.cardView.coverAttr]?i[e.widget.cardView.coverAttr].indexOf("http")>-1?i[e.widget.cardView.coverAttr]:e.Config.host+"/"+i[e.widget.cardView.coverAttr]:"",style:(0,a.j5)([{width:"100%","border-radius":"2px",display:"inline-block",cursor:"pointer"},i[e.widget.cardView.coverAttr]||"background:#f3f3f3;"])},null,12,Gt)])),(0,l._)("div",ei,[(0,l._)("div",ti,(0,a.zw)(e.Utils.cutString(i["content"],50)||"[ 空 ]"),1),((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.attributes,((s,n)=>((0,l.wg)(),(0,l.iD)("div",{key:n},[s.visible&&"content"!=s.name&&"title_img"!=s.name&&("checkbox"!=s.type&&i[s.name]||"checkbox"==s.type)?((0,l.wg)(),(0,l.iD)("div",ii,["true"==e.widget.cardView.showAttrLabel?((0,l.wg)(),(0,l.iD)("span",oi,(0,a.zw)(s.label||s.name)+"： ",1)):(0,l.kq)("",!0),"checkbox"==s.type?((0,l.wg)(),(0,l.j4)(r,{key:1,modelValue:i[s.name],"onUpdate:modelValue":e=>i[s.name]=e,style:{height:"inherit"},label:s.label,"true-label":"true","false-label":"false",onClick:t[0]||(t[0]=(0,o.iM)((()=>{}),["stop"])),onChange:t=>e.widget.saveAttrValue(i.block_id,s.type,s.name,i[s.name],e.widget)},null,8,["modelValue","onUpdate:modelValue","label","onChange"])):"rate"==s.type?((0,l.wg)(),(0,l.j4)(d,{key:2,modelValue:i[s.name],"onUpdate:modelValue":e=>i[s.name]=e,disabled:"system"==s.source,onClick:t[1]||(t[1]=(0,o.iM)((()=>{}),["stop"])),onChange:t=>e.widget.saveAttrValue(i.block_id,s.type,s.name,i[s.name],e.widget)},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"])):"select"==s.type||"multi_select"==s.type?((0,l.wg)(),(0,l.iD)("div",li,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.Utils.toArray(i[s.name]),(t=>((0,l.wg)(),(0,l.iD)("span",{key:t},[(0,l.Wm)(c,{class:(0,a.C_)(["select",e.Utils.tagStyle(t,s.name,e.attributes)])},{default:(0,l.w5)((()=>[(0,l.Uk)((0,a.zw)(t),1)])),_:2},1032,["class"])])))),128))])):((0,l.wg)(),(0,l.iD)("span",ai,(0,a.zw)(e.Utils.cutString(i[s.name],50)),1))])):(0,l.kq)("",!0)])))),128))])],8,Jt)))),128))])}var ni=(0,l.aZ)({name:"CardView",props:{widget:{},notes:[],attributes:[]},data(){return{data:[],Utils:jt}},methods:{stopPropagation(e){e.stopPropagation()}},mounted(){this.data=this.widget.totalNotes||[],setTimeout((()=>{this.$emit("doSomething","resize_iframe")}),1e3)},watch:{widget:{handler(){this.data=this.widget.totalNotes||[]},deep:!0}}});const _i=(0,$t.Z)(ni,[["render",si]]);var ri=_i;const di=["onClick"],ci={class:"list-view-row_attrs"},ui={key:0,class:"list-view-row_attr"},gi={key:0,style:{color:"grey"}},mi={key:3},pi={key:4};function wi(e,t,i,s,n,_){const r=(0,l.up)("el-checkbox"),d=(0,l.up)("el-rate"),c=(0,l.up)("el-tag");return(0,l.wg)(),(0,l.iD)("div",null,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.notes,(i=>((0,l.wg)(),(0,l.iD)("div",{class:"list-view-row",key:i.id},[(0,l._)("div",{class:"list-view-row_content",onClick:t=>e.Utils.openNote(i.block_id)},(0,a.zw)(i.content),9,di),(0,l._)("div",ci,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.attributes,((s,n)=>((0,l.wg)(),(0,l.iD)("div",{key:n},[s.visible&&"content"!=s.name&&"title_img"!=s.name&&("checkbox"!=s.type&&i[s.name]||"checkbox"==s.type)?((0,l.wg)(),(0,l.iD)("div",ui,["true"==e.widget.widgetSetting.showAttrLabel?((0,l.wg)(),(0,l.iD)("span",gi,(0,a.zw)(s.label||s.name)+"： ",1)):(0,l.kq)("",!0),"checkbox"==s.type?((0,l.wg)(),(0,l.j4)(r,{key:1,modelValue:i[s.name],"onUpdate:modelValue":e=>i[s.name]=e,style:{height:"inherit"},label:s.label,"true-label":"true","false-label":"false",size:"small",onClick:t[0]||(t[0]=(0,o.iM)((()=>{}),["stop"])),onChange:t=>e.widget.saveAttrValue(i.block_id,s.type,s.name,i[s.name],e.widget)},null,8,["modelValue","onUpdate:modelValue","label","onChange"])):"rate"==s.type?((0,l.wg)(),(0,l.j4)(d,{key:2,modelValue:i[s.name],"onUpdate:modelValue":e=>i[s.name]=e,disabled:"system"==s.source,size:"small",onClick:t[1]||(t[1]=(0,o.iM)((()=>{}),["stop"])),onChange:t=>e.widget.saveAttrValue(i.block_id,s.type,s.name,i[s.name],e.widget)},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"])):"select"==s.type||"multi_select"==s.type?((0,l.wg)(),(0,l.iD)("div",mi,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.Utils.toArray(i[s.name]),(t=>((0,l.wg)(),(0,l.iD)("span",{key:t},[(0,l.Wm)(c,{class:(0,a.C_)(["select",e.Utils.tagStyle(t,s.name,e.attributes)])},{default:(0,l.w5)((()=>[(0,l.Uk)((0,a.zw)(t),1)])),_:2},1032,["class"])])))),128))])):((0,l.wg)(),(0,l.iD)("span",pi,(0,a.zw)(i[s.name]),1))])):(0,l.kq)("",!0)])))),128))])])))),128))])}var hi=(0,l.aZ)({name:"TableView",props:{widget:ke.Z,notes:[],attributes:[]},computed:{visibleAttrs(){return this.widget.attributes.filter((e=>e.visible))}},data(){return{Utils:jt}}});const bi=(0,$t.Z)(hi,[["render",wi]]);var yi=bi;function fi(e,t,i,o,a,s){return(0,l.wg)(),(0,l.iD)("div",null," calendar ")}var vi=i(4870),Di=(0,l.aZ)({name:"CalendarView",props:{widget:ke.Z,notes:[],attributes:[]},data(){return{Utils:jt,buttonRef:(0,vi.iH)(),popoverRef:(0,vi.iH)(),visible:!1,name:"test",popover:{menu:{},submenu:{}}}}});const Ci=(0,$t.Z)(Di,[["render",fi]]);var Ei=Ci,ki=i(8249),Mi=i(7326);const Oi=e=>((0,l.dD)("data-v-2f351558"),e=e(),(0,l.Cn)(),e),Pi={key:0},Li={key:1},Si={style:{display:"flex","algin-item":"center","justify-content":"center","margin-bottom":"5px"}},Ui={key:0,style:{"margin-bottom":"5px"}},Wi=(0,l.Uk)("移除所有"),Vi={key:2},Ti=Oi((()=>(0,l._)("div",{style:{"font-size":"13px",color:"grey","margin-left":"10px"}}," 可以指定一个“图片”类型的属性作为卡片封面来源 ",-1))),xi=Oi((()=>(0,l._)("div",{style:{"font-size":"13px",color:"grey","margin-left":"10px"}}," 卡片视图下是否显示属性名称 ",-1))),Ai={key:3},Ii=Oi((()=>(0,l._)("div",{style:{"font-size":"13px",color:"grey","margin-left":"10px"}}," 列表视图下是否显示属性名称 ",-1))),Bi={key:4},Ki=Oi((()=>(0,l._)("div",{style:{"font-size":"13px",color:"grey","margin-left":"10px"}}," 是否显示表格行序号 ",-1))),Ri=Oi((()=>(0,l._)("div",{style:{"font-size":"13px",color:"grey","margin-left":"10px"}}," 是否在表格底部显示统计信息 ",-1))),zi=(0,l.Uk)("所有数据"),Ni=(0,l.Uk)("分页数据"),ji=Oi((()=>(0,l._)("div",{style:{"font-size":"13px",color:"grey","margin-left":"10px"}}," 选择是对分页数据还是所有数据进行统计 ",-1))),Zi={key:5},qi=(0,l.Uk)(" 移除后展示名称将显示为属性名，属性类型恢复为文本类型。该设置将在多个挂件中同步生效。 "),Hi=(0,l.Uk)("移除设置 "),$i={key:6},Fi=Oi((()=>(0,l._)("div",{style:{"font-size":"13px",color:"grey","margin-left":"10px"}}," 设置为 0 时则不分页 ",-1))),Qi=(0,l.Uk)("自动加载"),Yi=(0,l.Uk)("手动加载"),Ji=Oi((()=>(0,l._)("div",{style:{"font-size":"13px",color:"grey","margin-left":"10px"}}," 启动时是否自动加载最新数据，数据量大时建议选择手动加载 ",-1))),Xi=Oi((()=>(0,l._)("div",{style:{"font-size":"13px",color:"grey","margin-left":"10px"}}," 过滤满足正则表达式的属性 ",-1))),Gi={style:{display:"flex","justify-content":"center"}},eo={class:"recommend"},to=Oi((()=>(0,l._)("div",{class:"recommend_tips"},[(0,l.Uk)(" 如果 "),(0,l._)("b",null,"Note Views"),(0,l.Uk)(" 对你有帮助，订阅思源笔记时欢迎使用我的推荐码（点击复制） ")],-1))),io={class:"recommend_code"},oo=Oi((()=>(0,l._)("b",null,"4EY48YJ",-1))),lo=Oi((()=>(0,l._)("div",{style:{display:"flex","justify-content":"center","font-size":"13px",color:"#aaa","margin-top":"35px"}},[(0,l.Uk)(" Created by "),(0,l._)("a",{href:"https://github.com/langzhou/siyuan-note",target:"_blank"},"Langzhou"),(0,l.Uk)(", Inspired by "),(0,l._)("a",{href:"https://www.notion.so/",target:"_blank"},"Notion"),(0,l.Uk)(". ")],-1))),ao={class:"dialog-footer"},so=(0,l.Uk)("取消"),no=(0,l.Uk)("确定");function _o(e,t,i,s,n,_){const r=(0,l.up)("el-input"),d=(0,l.up)("el-form-item"),c=(0,l.up)("el-form"),u=(0,l.up)("el-tag"),g=(0,l.up)("draggable"),m=(0,l.up)("el-table-column"),p=(0,l.up)("el-table"),w=(0,l.up)("el-scrollbar"),h=(0,l.up)("el-option"),b=(0,l.up)("el-select"),y=(0,l.up)("el-switch"),f=(0,l.up)("el-radio"),v=(0,l.up)("el-button"),D=(0,l.up)("el-input-number"),C=(0,l.up)("el-dialog");return(0,l.wg)(),(0,l.j4)(C,{modelValue:e.isVisiable,"onUpdate:modelValue":t[17]||(t[17]=t=>e.isVisiable=t),title:e.dialogSetting.title,width:e.dialogSetting.width,"show-close":!1,"close-on-click-modal":!1,top:"2vh"},{footer:(0,l.w5)((()=>[(0,l._)("span",ao,[(0,l.Wm)(v,{onClick:t[16]||(t[16]=t=>e.handleClose(e.type))},{default:(0,l.w5)((()=>[so])),_:1}),(0,l.Wm)(v,{type:"primary",onClick:e.submit},{default:(0,l.w5)((()=>[no])),_:1},8,["onClick"])])])),default:(0,l.w5)((()=>["custom_sql"==e.type?((0,l.wg)(),(0,l.iD)("div",Pi,[(0,l.Wm)(c,{"label-width":"80px"},{default:(0,l.w5)((()=>[(0,l.Wm)(d,{label:"SQL语句"},{default:(0,l.w5)((()=>[(0,l.Wm)(r,{modelValue:e.customSQL,"onUpdate:modelValue":t[0]||(t[0]=t=>e.customSQL=t),placeholder:"请输入SQL语句",type:"textarea",autosize:{minRows:1,maxRows:5}},null,8,["modelValue"])])),_:1})])),_:1})])):"selected_notes"==e.type?((0,l.wg)(),(0,l.iD)("div",Li,[(0,l._)("div",Si,[(0,l.Wm)(r,{modelValue:e.searchInput,"onUpdate:modelValue":t[1]||(t[1]=t=>e.searchInput=t),placeholder:"输入笔记标题或 ID 查询，回车键进行搜索，最多添加 100 条",onKeyup:(0,o.D2)(e.searchNote,["enter"]),autofocus:"true"},null,8,["modelValue","onKeyup"])]),e.selectedNotes.length>0?((0,l.wg)(),(0,l.iD)("div",Ui,[(0,l.Wm)(u,{type:"info",style:{margin:"2px"}},{default:(0,l.w5)((()=>[(0,l.Uk)(" 已选 "+(0,a.zw)(e.selectedNotes.length)+" 条 ",1)])),_:1}),(0,l.Wm)(u,{type:"danger",onClose:t[2]||(t[2]=t=>e.handleTagClose(void 0)),closable:"",style:{margin:"2px"}},{default:(0,l.w5)((()=>[Wi])),_:1}),(0,l.Wm)(g,{modelValue:e.selectedNotes,"onUpdate:modelValue":t[3]||(t[3]=t=>e.selectedNotes=t),style:{display:"inline"}},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.selectedNotes,((t,i)=>((0,l.wg)(),(0,l.j4)(u,{key:i,closable:"",style:{margin:"2px",cursor:"move"},onClose:i=>e.handleTagClose(t)},{default:(0,l.w5)((()=>[(0,l.Uk)((0,a.zw)(e.cutString(t.content)),1)])),_:2},1032,["onClose"])))),128))])),_:1},8,["modelValue"])])):(0,l.kq)("",!0),(0,l.Wm)(w,{"max-height":"280px"},{default:(0,l.w5)((()=>[(0,l.Wm)(p,{ref:"selectNoteTable",data:e.notes,style:{width:"100%"},border:"",onSelectionChange:e.handleSelectionChange},{default:(0,l.w5)((()=>[(0,l.Wm)(m,{type:"selection",width:"40"}),(0,l.Wm)(m,{prop:"content",label:"标题"}),(0,l.Wm)(m,{prop:"hpath",label:"目录"}),(0,l.Wm)(m,{prop:"updated",label:"更新时间"}),(0,l.Wm)(m,{prop:"id",label:"ID"})])),_:1},8,["data","onSelectionChange"])])),_:1})])):"card_view"==e.type?((0,l.wg)(),(0,l.iD)("div",Vi,[(0,l.Wm)(c,{"label-width":"100px"},{default:(0,l.w5)((()=>[(0,l.Wm)(d,{label:"卡片封面"},{default:(0,l.w5)((()=>[(0,l.Wm)(b,{modelValue:e.cardView.coverAttr,"onUpdate:modelValue":t[4]||(t[4]=t=>e.cardView.coverAttr=t),teleported:!1},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.coverAttrs,(e=>((0,l.wg)(),(0,l.j4)(h,{key:e.name,label:e.label,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),Ti])),_:1}),(0,l.Wm)(d,{label:"显示属性名称"},{default:(0,l.w5)((()=>[(0,l.Wm)(y,{modelValue:e.cardView.showAttrLabel,"onUpdate:modelValue":t[5]||(t[5]=t=>e.cardView.showAttrLabel=t),"active-value":"true","inactive-value":"false"},null,8,["modelValue"]),xi])),_:1})])),_:1})])):"list_view"==e.type?((0,l.wg)(),(0,l.iD)("div",Ai,[(0,l.Wm)(c,{"label-width":"100px"},{default:(0,l.w5)((()=>[(0,l.Wm)(d,{label:"显示属性名称"},{default:(0,l.w5)((()=>[(0,l.Wm)(y,{modelValue:e.listView.showAttrLabel,"onUpdate:modelValue":t[6]||(t[6]=t=>e.listView.showAttrLabel=t),"active-value":"true","inactive-value":"false"},null,8,["modelValue"]),Ii])),_:1})])),_:1})])):"table_view"==e.type?((0,l.wg)(),(0,l.iD)("div",Bi,[(0,l.Wm)(c,{"label-width":"100px"},{default:(0,l.w5)((()=>[(0,l.Wm)(d,{label:"表格序号"},{default:(0,l.w5)((()=>[(0,l.Wm)(y,{modelValue:e.tableView.tableIndex,"onUpdate:modelValue":t[7]||(t[7]=t=>e.tableView.tableIndex=t),"active-value":"true","inactive-value":"false"},null,8,["modelValue"]),Ki])),_:1}),(0,l.Wm)(d,{label:"表格统计"},{default:(0,l.w5)((()=>[(0,l.Wm)(y,{modelValue:e.tableView.tableCount,"onUpdate:modelValue":t[8]||(t[8]=t=>e.tableView.tableCount=t),"active-value":"true","inactive-value":"false"},null,8,["modelValue"]),Ri])),_:1}),"true"==e.tableView.tableCount?((0,l.wg)(),(0,l.j4)(d,{key:0,label:"表格统计范围"},{default:(0,l.w5)((()=>[(0,l._)("div",null,[(0,l.Wm)(f,{modelValue:e.tableView.tableCountMode,"onUpdate:modelValue":t[9]||(t[9]=t=>e.tableView.tableCountMode=t),label:"total"},{default:(0,l.w5)((()=>[zi])),_:1},8,["modelValue"]),(0,l.Wm)(f,{modelValue:e.tableView.tableCountMode,"onUpdate:modelValue":t[10]||(t[10]=t=>e.tableView.tableCountMode=t),label:"page"},{default:(0,l.w5)((()=>[Ni])),_:1},8,["modelValue"])]),ji])),_:1})):(0,l.kq)("",!0)])),_:1})])):"shared_attrs"==e.type?((0,l.wg)(),(0,l.iD)("div",Zi,[(0,l.Wm)(u,{type:"warning"},{default:(0,l.w5)((()=>[qi])),_:1}),(0,l.Wm)(w,{"max-height":"300px"},{default:(0,l.w5)((()=>[(0,l.Wm)(p,{data:e.widget.sharedAttrs,style:{width:"100%"}},{default:(0,l.w5)((()=>[(0,l.Wm)(m,{label:"属性名"},{default:(0,l.w5)((e=>[(0,l.Wm)(u,null,{default:(0,l.w5)((()=>[(0,l.Uk)((0,a.zw)(e.row.name),1)])),_:2},1024)])),_:1}),(0,l.Wm)(m,{label:"展示名称"},{default:(0,l.w5)((e=>[(0,l.Wm)(r,{modelValue:e.row.label,"onUpdate:modelValue":t=>e.row.label=t,placeholder:"展示名称",style:{width:"100%"},clearable:""},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),(0,l.Wm)(m,{label:"属性类型"},{default:(0,l.w5)((t=>[(0,l.Wm)(b,{modelValue:t.row.type,"onUpdate:modelValue":e=>t.row.type=e,style:{width:"100%"}},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.Config.attr_types,((e,t)=>((0,l.wg)(),(0,l.j4)(h,{key:t,label:e.value,value:e.name},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),(0,l.Wm)(m,{label:"操作"},{default:(0,l.w5)((t=>[(0,l.Wm)(v,{size:"small",type:"warning",onClick:i=>e.widget.removeSharedAttr(t.row,t.$index,e.widget)},{default:(0,l.w5)((()=>[Hi])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])])),_:1})])):((0,l.wg)(),(0,l.iD)("div",$i,[(0,l.Wm)(w,{"max-height":"400px"},{default:(0,l.w5)((()=>[(0,l.Wm)(c,{"label-width":"110px"},{default:(0,l.w5)((()=>[(0,l.Wm)(d,{label:"挂件名称"},{default:(0,l.w5)((()=>[(0,l.Wm)(r,{modelValue:e.widgetSettings.widgetName,"onUpdate:modelValue":t[11]||(t[11]=t=>e.widgetSettings.widgetName=t),placeholder:"设置挂件名称",minlength:"1",maxlength:"50","show-word-limit":"true",style:{width:"220px"}},null,8,["modelValue"])])),_:1}),(0,l.Wm)(d,{label:"分页大小"},{default:(0,l.w5)((()=>[(0,l.Wm)(D,{modelValue:e.widgetSettings.pageSize,"onUpdate:modelValue":t[12]||(t[12]=t=>e.widgetSettings.pageSize=t),min:0,max:100,controls:!1,style:{width:"90px"}},null,8,["modelValue"]),Fi])),_:1}),(0,l.Wm)(d,{label:"加载模式",style:{"align-items":"center"}},{default:(0,l.w5)((()=>[(0,l._)("div",null,[(0,l.Wm)(f,{modelValue:e.widgetSettings.reload,"onUpdate:modelValue":t[13]||(t[13]=t=>e.widgetSettings.reload=t),label:"true"},{default:(0,l.w5)((()=>[Qi])),_:1},8,["modelValue"]),(0,l.Wm)(f,{modelValue:e.widgetSettings.reload,"onUpdate:modelValue":t[14]||(t[14]=t=>e.widgetSettings.reload=t),label:"false"},{default:(0,l.w5)((()=>[Yi])),_:1},8,["modelValue"])]),Ji])),_:1}),(0,l.Wm)(d,{label:"属性过滤"},{default:(0,l.w5)((()=>[(0,l.Wm)(r,{modelValue:e.widgetSettings.attrFilterReg,"onUpdate:modelValue":t[15]||(t[15]=t=>e.widgetSettings.attrFilterReg=t),placeholder:"输入正则表达式",style:{width:"220px"}},null,8,["modelValue"]),Xi])),_:1}),(0,l._)("div",Gi,[(0,l._)("div",eo,[to,(0,l._)("div",io,[(0,l.Wm)(u,{onClick:e.copyCode,size:"large",type:"warning"},{default:(0,l.w5)((()=>[oo])),_:1},8,["onClick"])]),lo])])])),_:1})])),_:1})]))])),_:1},8,["modelValue","title","width"])}var ro=i(5574),co=(0,l.aZ)({name:"DialogView",components:{draggable:ki.J},props:{dialog_visible:Boolean,type:String,widget:ke.Z},data(){return{isVisiable:!1,dialogSetting:{title:"挂件设置",width:"70%"},dialogTypes:{table_view:{title:"表格视图",width:"70%"},card_view:{title:"卡片视图",width:"50%"},list_view:{title:"列表视图",width:"70%"},custom_sql:{title:"自定义SQL",width:"70%"},selected_notes:{title:"手动添加文档",width:"70%"}},widgetSettings:{},tableView:{tableCount:"true",tableCountMode:"page"},cardView:{showAttrLabel:"true",coverAttr:"title_img"},listView:{showAttrLabel:"true"},Config:qt.D,reload:"true",customSQL:"",widgetName:"",pageSize:0,tableCount:"true",tableCountMode:"page",showAttrLabel:"true",attrFilter:"",searchInput:"",selectedNotes:[],notes:[]}},methods:{handleClose(e=""){this.$emit("closeDialog",e,!1),this.searchInput="",this.notes=this.selectedNotes=[]},handleSelectionChange(e){e.forEach((e=>{this.selectedNotes.includes(e)||this.selectedNotes.push(e)}))},handleTagClose(e){const t=this.$refs.selectNoteTable;if(e){const i=this.selectedNotes.indexOf(e),o=this.notes.indexOf(e);this.selectedNotes.splice(i,1),t.toggleRowSelection(this.notes[o],!1)}else this.selectedNotes=[],t.clearSelection()},submit(){switch(this.type){case"custom_sql":this.widget.saveSettings(Mi.Sd.CustomSQL,{custom_sql:this.customSQL},this.widget),this.customSQL="";break;case"selected_notes":if(this.selectedNotes.length>100)return void ro.z8.error("最多选择100条");this.$emit("closeDialog",this.type,!1,{selected_notes:this.selectedNotes}),this.selectedNotes=[];break;case"shared_attrs":this.$emit("closeDialog",this.type,!1,{});break;case"table_view":this.widget.saveSettings(Mi.Sd.TableView,this.tableView);break;case"list_view":this.widget.saveSettings(Mi.Sd.ListView,this.listView);break;case"card_view":this.widget.saveSettings(Mi.Sd.CardView,this.cardView);break;case"widget_setting":this.widget.saveSettings(Mi.Sd.WidgetSetting,this.widgetSettings);break;default:this.$emit("closeDialog",this.type,!1,{});break}},cutString(e){return(0,jt.cutString)(e,10)},init(){this.dialogSetting=this.dialogTypes[this.type]||{title:"挂件设置",width:"70%"}},searchNote(){this.searchInput.length>0?(0,jt.miniSearch)(this.searchInput).then((e=>{this.notes=e.data,0==this.notes.length&&(0,ro.z8)({message:"没有搜索到相关结果",type:"warning"})})):ro.z8.error("请输入搜索内容")},clearDatabase(){this.$emit("doSomething","clear_database")},copyCode(){(0,jt.copyText)("4EY48YJ"),(0,ro.z8)({showClose:!1,message:"❤  推荐码已复制 ~笔芯~ ❤",center:!0,type:"success"})}},computed:{coverAttrs(){return this.widget.attributes.filter((e=>"img"==e.type))}},watch:{widget:{handler(e){this.widgetSettings={...e.widgetSetting},this.tableView=e.tableView,this.cardView=e.cardView,this.listView=e.listView,this.customSQL=e.customSQL,this.selectedNotes=e.selectedNotes},deep:!0},dialog_visible(e){this.isVisiable=e},type(e){e&&this.init()}}});const uo=(0,$t.Z)(co,[["render",_o],["__scopeId","data-v-2f351558"]]);var go=uo,mo=(0,l.aZ)({name:"App",components:{draggable:ki.J,TableView:Qt,CardView:ri,ListView:yi,CalendarView:Ei,DialogView:go},data(){return{test:"",icon:Ee,icons:Nt,Config:qt.D,Utils:jt,widget:{},popoverVisible2:{menu:{},submenu:{}},popoverVisible:{attrs_list:!1,attrs_setting:!1,filter:!1,sort:!1}}},methods:{async loadNotes(){await this.widget.loadNotes()},refresh(){this.widget.refresh()},query(){this.widget.fetchLocalNotes()},getSelectSuggestions(e,t){return function(i){t.getSelectSuggestions(i,e)}},doSomething(e,t={}){switch(e){case"resize_table_width":this.widget.resizeTableWidth(t);break;case"resize_iframe":this.widget.resizeIframe();break;case"clear_database":this.widget.clearDatabase();break;case"toggle_popover":{const{menuName:e,type:i,action:o}=t;this.togglePopover2(e,i,o);break}default:break}},stopPropagation(e){e.stopPropagation()},closePopovers(e){for(const t in this.popoverVisible)this.popoverVisible[t]=!1},togglePopover(e,t){e.stopPropagation(),this.popoverVisible[t]=!this.popoverVisible[t];for(const i in this.popoverVisible)i!=t&&(this.popoverVisible[i]=!1)},togglePopover2(e,t="menu",i="toggle"){if(console.log("togglePopover2",e,t,i),"close_all"==i){for(const e in this.popoverVisible2["menu"])this.popoverVisible2["menu"][e]=!1;for(const e in this.popoverVisible2["submenu"])this.popoverVisible2["submenu"][e]=!1}else if("close_submenu"==i)for(const o in this.popoverVisible2["submenu"])o.indexOf(e)>-1&&(this.popoverVisible2["submenu"][o]=!1);else{void 0==this.popoverVisible2[t][e]?this.popoverVisible2[t][e]=!0:this.popoverVisible2[t][e]=!this.popoverVisible2[t][e];for(const i in this.popoverVisible2[t])i!=e&&(1==this.popoverVisible2[t][i]?this.popoverVisible2[t][i]=!1:delete this.popoverVisible2[t][i])}},toggleDialogVisible(e,t,i){this.widget.dialogType=e,this.widget.dialogVisible=void 0===t?!this.widget.dialogVisible:t,i&&this.widget.saveSettings(e,i)},handleFilterMode(e){this.widget.filterMode=e,this.widget.saveSettings(Mi.Sd.Filters,{data:"null"})},handlePageChange(e){this.widget.changePage(e)},resizeIframe(){const e=window.frameElement,t=window.document.body.scrollHeight;e.style.height=t+50+"px"}},created(){this.widget=new ke.Z,this.widget.init().then((()=>{this.loadNotes()}))}});const po=(0,$t.Z)(mo,[["render",Ce]]);var wo=po,ho=i(8437),bo=(i(4415),i(812));(0,o.ri)(wo).use(ho.Z,{locale:bo.Z}).mount("#app")},6583:function(e,t,i){i.r(t),i.d(t,{ReplaceBR:function(){return m},ReplaceSpace:function(){return p},arraySort:function(){return M},copyText:function(){return c},cutString:function(){return C},dateFormat:function(){return D},friendlyTime:function(){return w},getAttrType:function(){return S},getDocumentID:function(){return L},getWidgetID:function(){return P},htmlDecode:function(){return k},miniSearch:function(){return O},openNote:function(){return s},praseJSON:function(){return E},randomWord:function(){return u},selectOptionStyle:function(){return d},siyuanTimeFormat:function(){return v},siyuanTimeToDate:function(){return y},siyuanTimeToDateStr:function(){return h},siyuanTimeToTimestamp:function(){return b},stringPin:function(){return g},tagStyle:function(){return r},timestampFormat:function(){return f},toArray:function(){return n},toBoolean:function(){return _}});var o=i(7573),l=i(8153),a=i(7326);const s=e=>{window.open("siyuan://blocks/"+e,"_blank")},n=e=>e?String(e).split(","):[],_=e=>{const t=typeof e;return"boolean"===t?e:"string"===t?"true"===e||"1"===e||"yes"===e:"number"===t&&1===e},r=(e,t,i)=>{const o=i.find((e=>e.name==t));if(o){const t=o.options,i=t.find((t=>t.value==e));return i?i.color:"grey"}return"grey"},d=e=>{const t=o.D.tag_colors.find((t=>t.name==e));return t?`background: ${t.background};color: ${t.color};`:"color: rgb(111, 113, 115);background-color: rgba(162, 164, 166, 0.2);"};async function c(e){try{await navigator.clipboard.writeText(e)}catch(t){console.error("Failed to copy: ",t)}}const u=(e,t,i)=>{let o="",l=t;const a=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];e&&(l=Math.round(Math.random()*(i-t))+t);for(let s=0;s<l;s++){const e=Math.round(Math.random()*(a.length-1));o+=a[e]}return o},g=(...e)=>{if(0===e.length)return"";{const t=e.reduce(((e,t)=>String(e)+String(t)));return t}},m=(e,t)=>e.replace(/[\r\n]+/g,t),p=(e,t)=>e.replace(/\s+/g,t),w=e=>{if(!e)return"";const t=new Date,i=t.getFullYear(),o=new Date(e).getFullYear();return f(e,i==o?"M月d日 hh:mm:ss":"yyyy年M月d日 hh:mm:ss")},h=e=>e.replace(/^(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})$/,"$1-$2-$3 $4:$5:$6"),b=e=>{try{return new Date(h(e)).getTime()}catch{return 0}},y=e=>new Date(h(e)),f=(e,t)=>D(new Date(e),t),v=(e,t)=>D(new Date(b(e)),t),D=(e,t)=>{const i={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));for(const o in i)new RegExp("("+o+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?i[o]:("00"+i[o]).substr((""+i[o]).length)));return t},C=(e,t)=>e.length>t?e.substr(0,t)+"...":e,E=e=>{if(!e)return!1;try{return JSON.parse(e)}catch(t){return console.log(`JSON 解析失败: ${e}`),!1}},k=e=>{try{let t="";return 0==e.length?"":(t=e.replace(/&amp;/g,"&"),t=t.replace(/&lt;/g,"<"),t=t.replace(/&gt;/g,">"),t=t.replace(/&nbsp;/g," "),t=t.replace(/&#39;/g,"'"),t=t.replace(/&quot;/g,'"'),t)}catch(t){return""}},M=e=>{const t=e,i=e.length;for(let o=0;o<i;o++)for(let e=0;e<i-1-o;e++){const i=t[e]["order"],o=t[e+1]["order"];let l="string"==typeof i?parseInt(i):i,a="string"==typeof o?parseInt(o):o;if(l=l||0,a=a||0,l>a){const i=t[e+1];t[e+1]=t[e],t[e]=i}}return t},O=(e,t=50)=>l.Xk(a.bl.QuerySQL,{stmt:`select * from blocks where (content like '%${e}%' or id = '${e}') and type = 'd' limit ${t}`}),P=()=>{const e=window.frameElement,t=e?.parentElement?.parentElement;return null!=t?{code:0,data:{id:t.dataset.nodeId,node:t}}:{code:-1,data:{}}};async function L(e){const{code:t,msg:i,data:o}=await l.Xk(a.bl.QuerySQL,{stmt:`SELECT root_id FROM blocks WHERE id = '${e}'`});return 0===t&&o.length>0?o[0].root_id:""}const S=(e,t)=>{const i=t.attributes.find((t=>t.name===e));return i?i.type:"text"}},8153:function(e,t,i){i.d(t,{Xk:function(){return a}});i(1703);var o=i(7573),l=i(5574);async function a(e,t,i=""){const a=o.D.api.find((t=>t.type===e));return new Promise(((n,_)=>{a?s(o.D.host+a.url,t).then((t=>{0==t.code?n({code:0,data:t.data,msg:""}):(l.z8.error(i||"网络请求错误 ["+e+"]："+t.msg),n({code:-1,data:{},msg:t.msg}))})).catch((t=>{l.z8.error(i||"网络请求错误 ["+e+"]："+t.message),n({code:-1,data:{},msg:t.message})})):_({code:-1,data:{},msg:`${e} 接口类型不存在`})}))}function s(e,t,i="POST"){return new Promise(((l,a)=>{"POST"==i.toUpperCase()?fetch(e,{method:"POST",headers:{"Content-Type":"application/json","User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4844.74 Safari/537.36"},body:JSON.stringify(t)}).then(o).then((e=>l(e))).catch((e=>a(e))):fetch(e,{method:"GET",headers:{"User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4844.74 Safari/537.36"}}).then(o).then((e=>l(e))).catch((e=>a(e)))}));function o(e){const t=e.headers.get("content-type");if(t.includes("application/json"))return l(e);if(t.includes("text/html"))return a(e);throw new Error(`Sorry, content-type ${t} not supported`)}function l(e){return e.json().then((t=>e.ok?t:Promise.reject(Object.assign({},t,{status:e.status,statusText:e.statusText}))))}function a(e){return e.text().then((t=>e.ok?t:Promise.reject({status:e.status,statusText:e.statusText,err:t})))}}}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var i=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e].call(i.exports,i,i.exports,__webpack_require__),i.exports}__webpack_require__.m=__webpack_modules__,function(){var e=[];__webpack_require__.O=function(t,i,o,l){if(!i){var a=1/0;for(r=0;r<e.length;r++){i=e[r][0],o=e[r][1],l=e[r][2];for(var s=!0,n=0;n<i.length;n++)(!1&l||a>=l)&&Object.keys(__webpack_require__.O).every((function(e){return __webpack_require__.O[e](i[n])}))?i.splice(n--,1):(s=!1,l<a&&(a=l));if(s){e.splice(r--,1);var _=o();void 0!==_&&(t=_)}}return t}l=l||0;for(var r=e.length;r>0&&e[r-1][2]>l;r--)e[r]=e[r-1];e[r]=[i,o,l]}}(),function(){__webpack_require__.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return __webpack_require__.d(t,{a:t}),t}}(),function(){__webpack_require__.d=function(e,t){for(var i in t)__webpack_require__.o(t,i)&&!__webpack_require__.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})}}(),function(){__webpack_require__.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){__webpack_require__.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};__webpack_require__.O.j=function(t){return 0===e[t]};var t=function(t,i){var o,l,a=i[0],s=i[1],n=i[2],_=0;if(a.some((function(t){return 0!==e[t]}))){for(o in s)__webpack_require__.o(s,o)&&(__webpack_require__.m[o]=s[o]);if(n)var r=n(__webpack_require__)}for(t&&t(i);_<a.length;_++)l=a[_],__webpack_require__.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return __webpack_require__.O(r)},i=self["webpackChunknote_views_v3"]=self["webpackChunknote_views_v3"]||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))}();var __webpack_exports__=__webpack_require__.O(void 0,[998],(function(){return __webpack_require__(1944)}));__webpack_exports__=__webpack_require__.O(__webpack_exports__)})();